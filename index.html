<!DOCTYPE html><!--  Last Published: Sun Oct 05 2025 01:03:38 GMT+0000 (Coordinated Universal Time)  -->
<html data-wf-page="683b63acf5908465c8825cb3" data-wf-site="683b63acf5908465c8825ca8">
<head>
  <meta charset="utf-8">
  <title>MEMORIO FORMS</title>
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <!-- Preload Dosis font to prevent FOUC -->
  <link rel="preload" href="fonts/Dosis-VariableFont_wght.ttf" as="font" type="font/ttf" crossorigin>
  <link href="css/normalize.css" rel="stylesheet" type="text/css">
  <link href="css/webflow.css" rel="stylesheet" type="text/css">
  <link href="css/memorio-forms.webflow.css" rel="stylesheet" type="text/css">
  <script type="text/javascript">!function(o,c){var n=c.documentElement,t=" w-mod-";n.className+=t+"js",("ontouchstart"in o||o.DocumentTouch&&c instanceof DocumentTouch)&&(n.className+=t+"touch")}(window,document);</script>
  <link href="images/favicon.png" rel="shortcut icon" type="image/x-icon">
  <link href="images/webclip.png" rel="apple-touch-icon">
  <link href="https://www.memorio.ai" rel="canonical">
  <script src="https://cdn.prod.website-files.com/683b63acf5908465c8825ca8%2F685146e1d8a68f749232b664%2F68ae0b3dfa796259386da2c8%2Fimportucanddefinelocales-1.1.1.js" type="text/javascript"></script>
  <script src="https://cdn.prod.website-files.com/683b63acf5908465c8825ca8%2F685146e1d8a68f749232b664%2F68ae0b3ee913e1d7f8841a9b%2Fcssimporter-0.0.1.js" type="text/javascript"></script>
  
  <!-- Supabase Client for Authentication and Database -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  
  <!-- Hide form content initially to prevent flashing -->
  <style>
    .form-container, .form-wrapper, .w-form {
      display: none !important;
    }
    .form-container.show, .form-wrapper.show, .w-form.show {
      display: block !important;
    }
  </style>
</head>
<body class="body">
  <!-- Login Modal -->
  <div id="loginModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 9999; justify-content: center; align-items: center;">
    <div style="background-color: #fff3e9; border: 3px solid #436481; border-radius: 20px; padding: 48px; max-width: 500px; width: 90%; box-shadow: 0 2px 8px -2px rgba(0,0,0,0.2);">
      <h1 style="color: #32343a; text-align: center; font-size: 32px; font-weight: 600; margin-bottom: 10px; font-family: 'Dosis Variablefont Wght', Arial, sans-serif;">Family Portal</h1>
      <p style="color: #32343a; text-align: center; font-size: 16px; margin-bottom: 30px; font-family: 'Dosis Variablefont Wght', Arial, sans-serif;">Sign in to complete your obituary form</p>
      
      <div id="loginError" style="display: none; background-color: #ffebee; border: 1px solid #ef5350; color: #c62828; padding: 12px; border-radius: 8px; margin-bottom: 20px; font-size: 14px; font-family: 'Dosis Variablefont Wght', Arial, sans-serif;"></div>
      
      <form id="loginForm" onsubmit="handleLogin(event)">
        <div style="margin-bottom: 20px;">
          <label style="display: block; color: #32343a; font-size: 14px; font-weight: 600; margin-bottom: 8px; font-family: 'Dosis Variablefont Wght', Arial, sans-serif;">Email Address</label>
          <input type="email" 
                 id="loginEmail" 
                 style="width: 100%; padding: 12px; border: 2px solid #436481; border-radius: 8px; font-size: 16px; font-family: 'Dosis Variablefont Wght', Arial, sans-serif; background-color: #ffffff; box-sizing: border-box;"
                 placeholder="Enter your email"
                 required>
        </div>
        
        <div style="margin-bottom: 20px;">
          <label style="display: block; color: #32343a; font-size: 14px; font-weight: 600; margin-bottom: 8px; font-family: 'Dosis Variablefont Wght', Arial, sans-serif;">Password</label>
          <input type="password" 
                 id="loginPassword" 
                 style="width: 100%; padding: 12px; border: 2px solid #436481; border-radius: 8px; font-size: 16px; font-family: 'Dosis Variablefont Wght', Arial, sans-serif; background-color: #ffffff; box-sizing: border-box;"
                 placeholder="Enter your password"
                 required>
        </div>
        
        <button type="submit" 
                id="loginBtn"
                style="width: 100%; padding: 14px; background-color: #436481; color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; font-family: 'Dosis Variablefont Wght', Arial, sans-serif; transition: background-color 0.2s;">
          Sign In
        </button>
      </form>
      
      <p style="text-align: center; color: #666; font-size: 14px; margin-top: 20px; font-family: 'Dosis Variablefont Wght', Arial, sans-serif;">
        Don't have login credentials?<br>
        Contact your funeral director for access.
      </p>
    </div>
  </div>

  <!-- Password Change Modal (First-time Login) -->
  <div id="passwordChangeModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 10000; justify-content: center; align-items: center;">
    <div style="background-color: #fff3e9; border: 3px solid #436481; border-radius: 20px; padding: 48px; max-width: 500px; width: 90%; box-shadow: 0 2px 8px -2px rgba(0,0,0,0.2);">
      <h1 style="color: #32343a; text-align: center; font-size: 32px; font-weight: 600; margin-bottom: 10px; font-family: 'Dosis Variablefont Wght', Arial, sans-serif;">Create Your Password</h1>
      <p style="color: #32343a; text-align: center; font-size: 16px; margin-bottom: 30px; font-family: 'Dosis Variablefont Wght', Arial, sans-serif;">For security, please create a new permanent password</p>
      
      <div id="passwordChangeError" style="display: none; background-color: #ffebee; border: 1px solid #ef5350; color: #c62828; padding: 12px; border-radius: 8px; margin-bottom: 20px; font-size: 14px; font-family: 'Dosis Variablefont Wght', Arial, sans-serif;"></div>
      
      <form id="passwordChangeForm" onsubmit="handlePasswordChange(event)">
        <div style="margin-bottom: 20px;">
          <label style="display: block; color: #32343a; font-size: 14px; font-weight: 600; margin-bottom: 8px; font-family: 'Dosis Variablefont Wght', Arial, sans-serif;">New Password</label>
          <input type="password" 
                 id="newPassword" 
                 style="width: 100%; padding: 12px; border: 2px solid #436481; border-radius: 8px; font-size: 16px; font-family: 'Dosis Variablefont Wght', Arial, sans-serif; background-color: #ffffff; box-sizing: border-box;"
                 placeholder="Enter a strong password"
                 required
                 minlength="8">
          <small style="display: block; color: #666; font-size: 12px; margin-top: 4px; font-family: 'Dosis Variablefont Wght', Arial, sans-serif;">Minimum 8 characters</small>
        </div>
        
        <div style="margin-bottom: 20px;">
          <label style="display: block; color: #32343a; font-size: 14px; font-weight: 600; margin-bottom: 8px; font-family: 'Dosis Variablefont Wght', Arial, sans-serif;">Confirm Password</label>
          <input type="password" 
                 id="confirmPassword" 
                 style="width: 100%; padding: 12px; border: 2px solid #436481; border-radius: 8px; font-size: 16px; font-family: 'Dosis Variablefont Wght', Arial, sans-serif; background-color: #ffffff; box-sizing: border-box;"
                 placeholder="Re-enter your password"
                 required
                 minlength="8">
        </div>
        
        <button type="submit" 
                id="passwordChangeBtn"
                style="width: 100%; padding: 14px; background-color: #436481; color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; font-family: 'Dosis Variablefont Wght', Arial, sans-serif; transition: background-color 0.2s;">
          Set New Password
        </button>
      </form>
    </div>
  </div>

  <div class="nav">
    <div class="logo-wrapper"><img src="images/Screenshot_2025-03-29_at_6.43.40_PM-removebg-preview.png" loading="lazy" width="166" sizes="166px" alt="The Memorio Logo" srcset="images/Screenshot_2025-03-29_at_6.43.40_PM-removebg-preview-p-500.png 500w, images/Screenshot_2025-03-29_at_6.43.40_PM-removebg-preview-p-800.png 800w, images/Screenshot_2025-03-29_at_6.43.40_PM-removebg-preview.png 838w"></div>
  </div>
  <div class="form-slider-padding">
    <div class="w-form">
      <form id="wf-form-memorio_obituary_form" name="wf-form-memorio_obituary_form" data-name="memorio_obituary_form" method="get" class="form-2" data-wf-page-id="683b63acf5908465c8825cb3" data-wf-element-id="faaf2315-7be8-4814-9169-c55030b0674d">
        <!-- Step 1 removed: customer name/email (collected by director) -->
        <div data-w-id="d026be39-46e7-e794-7d04-b04fb7e8fd1c" class="form-slider-step-1">
          <div class="form-title">
            <div class="text-block">Memorios Obituary Writer</div>
            <h1 class="heading-2" id="welcome-heading">Lets begin!</h1>
          </div>
          <div class="form-bubbles">
            <div class="bubble-container">
              <p class="paragraph">Take your time, each question helps us gently piece together a heartfelt memory. There's no rush, and you can always go back.</p>
            </div>
          </div>
          <div class="form-questions">
            <div class="form-box">
              <div class="form-fields">
                <!-- Loved one's name/gender removed: collected by director in case creation -->
                <label for="loved_ones_salutation" class="field-label loved-ones-name other-names">Any other names you&#x27;d like to include for <span id="deceased-name-display"></span>?</label><input class="text-field loved-ones-first-name salutation w-input" maxlength="256" name="loved_ones_salutation" data-name="loved_ones_salutation" placeholder="Salutation" type="text" id="loved_ones_salutation"><input class="text-field loved-ones-first-name middle-name w-input" maxlength="256" name="loved_ones_middle_name" data-name="loved_ones_middle_name" placeholder="Middle Name" type="text" id="loved_ones_middle_name"><input class="text-field loved-ones-first-name nickname w-input" maxlength="256" name="loved_ones_nickname" data-name="loved_ones_nickname" placeholder="Nickname" type="text" id="loved_ones_nickname"><input class="text-field loved-ones-first-name maiden-name w-input" maxlength="256" name="loved_ones_maiden_name" data-name="loved_ones_maiden_name" placeholder="Maiden Name" type="text" id="loved_ones_maiden_name"><select id="loved_ones_suffix" name="loved_ones_suffix" data-name="loved_ones_suffix" class="select-field suffix w-select">
                  <option value="Another option">Suffix (Jr, Sr, etc.)</option>
                  <option value="Junior">Jr.</option>
                  <option value="Senior">Sr.</option>
                  <option value="The second">II</option>
                  <option value="The third">III</option>
                </select>
                <div class="text-block-2">*Required Fields</div>
              </div>
              <div class="form-button">
                <a href="#" class="button-primary get-started next w-button">NEXT</a>
                <div data-w-id="4d498b7d-9bc8-ceed-117d-c4aa28126788" class="div-block back"></div>
                <div data-w-id="793327fe-8485-9407-6612-d7d9119ceaf3" class="div-block">NEXT</div><input type="submit" data-wait="Please wait..." class="submit-button w-button" value="SUBMIT">
              </div>
            </div>
          </div>
        </div>
        <div data-w-id="720dd103-9ec0-191a-5fd0-063d9f3e65a9" class="form-slider-step-1 step-2 step-3">
          <div class="form-title">
            <div class="text-block">Memorios Obituary Writer</div>
            <h1 class="heading-2">When Did Your Loved One Pass?</h1>
          </div>
          <div class="form-bubbles">
            <div class="bubble-container">
              <p class="paragraph">We understand this is a delicate moment. By sharing a few details about your loved one&#x27;s passing, we can help craft a meaningful tribute that honors their life with care and respect.</p>
            </div>
          </div>
          <div class="form-questions">
            <div class="form-box">
              <div class="form-fields"><label for="date_of_passing" class="field-label">Please provide more details about their passing</label>
                <div class="date-input-group">
                  <select name="month_of_passing" data-name="month_of_passing" id="month_of_passing" class="select-field w-select" required>
                    <option value="">Month*</option>
                    <option value="01">January</option>
                    <option value="02">February</option>
                    <option value="03">March</option>
                    <option value="04">April</option>
                    <option value="05">May</option>
                    <option value="06">June</option>
                    <option value="07">July</option>
                    <option value="08">August</option>
                    <option value="09">September</option>
                    <option value="10">October</option>
                    <option value="11">November</option>
                    <option value="12">December</option>
                  </select>
                  <select name="day_of_passing" data-name="day_of_passing" id="day_of_passing" class="select-field w-select" required>
                    <option value="">Day*</option>
                    <option value="01">1</option><option value="02">2</option><option value="03">3</option><option value="04">4</option><option value="05">5</option>
                    <option value="06">6</option><option value="07">7</option><option value="08">8</option><option value="09">9</option><option value="10">10</option>
                    <option value="11">11</option><option value="12">12</option><option value="13">13</option><option value="14">14</option><option value="15">15</option>
                    <option value="16">16</option><option value="17">17</option><option value="18">18</option><option value="19">19</option><option value="20">20</option>
                    <option value="21">21</option><option value="22">22</option><option value="23">23</option><option value="24">24</option><option value="25">25</option>
                    <option value="26">26</option><option value="27">27</option><option value="28">28</option><option value="29">29</option><option value="30">30</option>
                    <option value="31">31</option>
                  </select>
                  <select name="year_of_passing" data-name="year_of_passing" id="year_of_passing" class="select-field w-select" required>
                    <option value="">Year*</option>
                    <option value="2025">2025</option><option value="2024">2024</option><option value="2023">2023</option><option value="2022">2022</option><option value="2021">2021</option>
                    <option value="2020">2020</option><option value="2019">2019</option><option value="2018">2018</option><option value="2017">2017</option><option value="2016">2016</option>
                    <option value="2015">2015</option><option value="2014">2014</option><option value="2013">2013</option><option value="2012">2012</option><option value="2011">2011</option>
                    <option value="2010">2010</option><option value="2009">2009</option><option value="2008">2008</option><option value="2007">2007</option><option value="2006">2006</option>
                    <option value="2005">2005</option><option value="2004">2004</option><option value="2003">2003</option><option value="2002">2002</option><option value="2001">2001</option>
                    <option value="2000">2000</option><option value="1999">1999</option><option value="1998">1998</option><option value="1997">1997</option><option value="1996">1996</option>
                    <option value="1995">1995</option><option value="1994">1994</option><option value="1993">1993</option><option value="1992">1992</option><option value="1991">1991</option>
                    <option value="1990">1990</option><option value="1989">1989</option><option value="1988">1988</option><option value="1987">1987</option><option value="1986">1986</option>
                    <option value="1985">1985</option><option value="1984">1984</option><option value="1983">1983</option><option value="1982">1982</option><option value="1981">1981</option>
                    <option value="1980">1980</option><option value="1979">1979</option><option value="1978">1978</option><option value="1977">1977</option><option value="1976">1976</option>
                    <option value="1975">1975</option><option value="1974">1974</option><option value="1973">1973</option><option value="1972">1972</option><option value="1971">1971</option>
                    <option value="1970">1970</option><option value="1969">1969</option><option value="1968">1968</option><option value="1967">1967</option><option value="1966">1966</option>
                    <option value="1965">1965</option><option value="1964">1964</option><option value="1963">1963</option><option value="1962">1962</option><option value="1961">1961</option>
                    <option value="1960">1960</option><option value="1959">1959</option><option value="1958">1958</option><option value="1957">1957</option><option value="1956">1956</option>
                    <option value="1955">1955</option><option value="1954">1954</option><option value="1953">1953</option><option value="1952">1952</option><option value="1951">1951</option>
                    <option value="1950">1950</option><option value="1949">1949</option><option value="1948">1948</option><option value="1947">1947</option><option value="1946">1946</option>
                    <option value="1945">1945</option><option value="1944">1944</option><option value="1943">1943</option><option value="1942">1942</option><option value="1941">1941</option>
                    <option value="1940">1940</option><option value="1939">1939</option><option value="1938">1938</option><option value="1937">1937</option><option value="1936">1936</option>
                    <option value="1935">1935</option><option value="1934">1934</option><option value="1933">1933</option><option value="1932">1932</option><option value="1931">1931</option>
                    <option value="1930">1930</option><option value="1929">1929</option><option value="1928">1928</option><option value="1927">1927</option><option value="1926">1926</option>
                    <option value="1925">1925</option><option value="1924">1924</option><option value="1923">1923</option><option value="1922">1922</option><option value="1921">1921</option>
                    <option value="1920">1920</option><option value="1919">1919</option><option value="1918">1918</option><option value="1917">1917</option><option value="1916">1916</option>
                    <option value="1915">1915</option><option value="1914">1914</option><option value="1913">1913</option><option value="1912">1912</option><option value="1911">1911</option>
                    <option value="1910">1910</option><option value="1909">1909</option><option value="1908">1908</option><option value="1907">1907</option><option value="1906">1906</option>
                    <option value="1905">1905</option><option value="1904">1904</option><option value="1903">1903</option><option value="1902">1902</option><option value="1901">1901</option>
                    <option value="1900">1900</option>
                  </select>
                </div>
                <input class="text-field w-input" maxlength="256" name="city_of_passing" data-name="city_of_passing" placeholder="City of Passing*" type="text" id="city_of_passing" required="">
                <input class="text-field w-input" maxlength="256" name="state_of_passing" data-name="state_of_passing" placeholder="State of Passing" type="text" id="state_of_passing">
                <select name="country_of_passing" data-name="country_of_passing" id="country_of_passing" class="select-field w-select" required>
                  <option value="">Country of Passing*</option>
                  <option value="United States">United States</option>
                  <option value="Afghanistan">Afghanistan</option>
                  <option value="Albania">Albania</option>
                  <option value="Algeria">Algeria</option>
                  <option value="American Samoa">American Samoa</option>
                  <option value="Andorra">Andorra</option>
                  <option value="Angola">Angola</option>
                  <option value="Anguilla">Anguilla</option>
                  <option value="Antarctica">Antarctica</option>
                  <option value="Antigua and Barbuda">Antigua and Barbuda</option>
                  <option value="Argentina">Argentina</option>
                  <option value="Armenia">Armenia</option>
                  <option value="Aruba">Aruba</option>
                  <option value="Australia">Australia</option>
                  <option value="Austria">Austria</option>
                  <option value="Azerbaijan">Azerbaijan</option>
                  <option value="Bahamas">Bahamas</option>
                  <option value="Bahrain">Bahrain</option>
                  <option value="Bangladesh">Bangladesh</option>
                  <option value="Barbados">Barbados</option>
                  <option value="Belarus">Belarus</option>
                  <option value="Belgium">Belgium</option>
                  <option value="Belize">Belize</option>
                  <option value="Benin">Benin</option>
                  <option value="Bermuda">Bermuda</option>
                  <option value="Bhutan">Bhutan</option>
                  <option value="Bolivia">Bolivia</option>
                  <option value="Bosnia and Herzegovina">Bosnia and Herzegovina</option>
                  <option value="Botswana">Botswana</option>
                  <option value="Bouvet Island">Bouvet Island</option>
                  <option value="Brazil">Brazil</option>
                  <option value="British Indian Ocean Territory">British Indian Ocean Territory</option>
                  <option value="Brunei Darussalam">Brunei Darussalam</option>
                  <option value="Bulgaria">Bulgaria</option>
                  <option value="Burkina Faso">Burkina Faso</option>
                  <option value="Burundi">Burundi</option>
                  <option value="Cambodia">Cambodia</option>
                  <option value="Cameroon">Cameroon</option>
                  <option value="Canada">Canada</option>
                  <option value="Cape Verde">Cape Verde</option>
                  <option value="Cayman Islands">Cayman Islands</option>
                  <option value="Central African Republic">Central African Republic</option>
                  <option value="Chad">Chad</option>
                  <option value="Chile">Chile</option>
                  <option value="China">China</option>
                  <option value="Christmas Island">Christmas Island</option>
                  <option value="Cocos (Keeling) Islands">Cocos (Keeling) Islands</option>
                  <option value="Colombia">Colombia</option>
                  <option value="Comoros">Comoros</option>
                  <option value="Congo">Congo</option>
                  <option value="Congo, The Democratic Republic of the">Congo, The Democratic Republic of the</option>
                  <option value="Cook Islands">Cook Islands</option>
                  <option value="Costa Rica">Costa Rica</option>
                  <option value="Cote D'Ivoire">Cote D'Ivoire</option>
                  <option value="Croatia">Croatia</option>
                  <option value="Cuba">Cuba</option>
                  <option value="Cyprus">Cyprus</option>
                  <option value="Czech Republic">Czech Republic</option>
                  <option value="Denmark">Denmark</option>
                  <option value="Djibouti">Djibouti</option>
                  <option value="Dominica">Dominica</option>
                  <option value="Dominican Republic">Dominican Republic</option>
                  <option value="Ecuador">Ecuador</option>
                  <option value="Egypt">Egypt</option>
                  <option value="El Salvador">El Salvador</option>
                  <option value="Equatorial Guinea">Equatorial Guinea</option>
                  <option value="Eritrea">Eritrea</option>
                  <option value="Estonia">Estonia</option>
                  <option value="Ethiopia">Ethiopia</option>
                  <option value="Falkland Islands (Malvinas)">Falkland Islands (Malvinas)</option>
                  <option value="Faroe Islands">Faroe Islands</option>
                  <option value="Fiji">Fiji</option>
                  <option value="Finland">Finland</option>
                  <option value="France">France</option>
                  <option value="French Guiana">French Guiana</option>
                  <option value="French Polynesia">French Polynesia</option>
                  <option value="French Southern Territories">French Southern Territories</option>
                  <option value="Gabon">Gabon</option>
                  <option value="Gambia">Gambia</option>
                  <option value="Georgia">Georgia</option>
                  <option value="Germany">Germany</option>
                  <option value="Ghana">Ghana</option>
                  <option value="Gibraltar">Gibraltar</option>
                  <option value="Greece">Greece</option>
                  <option value="Greenland">Greenland</option>
                  <option value="Grenada">Grenada</option>
                  <option value="Guadeloupe">Guadeloupe</option>
                  <option value="Guam">Guam</option>
                  <option value="Guatemala">Guatemala</option>
                  <option value="Guernsey">Guernsey</option>
                  <option value="Guinea">Guinea</option>
                  <option value="Guinea-Bissau">Guinea-Bissau</option>
                  <option value="Guyana">Guyana</option>
                  <option value="Haiti">Haiti</option>
                  <option value="Heard Island and Mcdonald Islands">Heard Island and Mcdonald Islands</option>
                  <option value="Holy See (Vatican City State)">Holy See (Vatican City State)</option>
                  <option value="Honduras">Honduras</option>
                  <option value="Hong Kong">Hong Kong</option>
                  <option value="Hungary">Hungary</option>
                  <option value="Iceland">Iceland</option>
                  <option value="India">India</option>
                  <option value="Indonesia">Indonesia</option>
                  <option value="Iran, Islamic Republic Of">Iran, Islamic Republic Of</option>
                  <option value="Iraq">Iraq</option>
                  <option value="Ireland">Ireland</option>
                  <option value="Isle of Man">Isle of Man</option>
                  <option value="Israel">Israel</option>
                  <option value="Italy">Italy</option>
                  <option value="Jamaica">Jamaica</option>
                  <option value="Japan">Japan</option>
                  <option value="Jersey">Jersey</option>
                  <option value="Jordan">Jordan</option>
                  <option value="Kazakhstan">Kazakhstan</option>
                  <option value="Kenya">Kenya</option>
                  <option value="Kiribati">Kiribati</option>
                  <option value="Korea, Democratic People'S Republic of">Korea, Democratic People'S Republic of</option>
                  <option value="Korea, Republic of">Korea, Republic of</option>
                  <option value="Kuwait">Kuwait</option>
                  <option value="Kyrgyzstan">Kyrgyzstan</option>
                  <option value="Lao People'S Democratic Republic">Lao People'S Democratic Republic</option>
                  <option value="Latvia">Latvia</option>
                  <option value="Lebanon">Lebanon</option>
                  <option value="Lesotho">Lesotho</option>
                  <option value="Liberia">Liberia</option>
                  <option value="Libyan Arab Jamahiriya">Libyan Arab Jamahiriya</option>
                  <option value="Liechtenstein">Liechtenstein</option>
                  <option value="Lithuania">Lithuania</option>
                  <option value="Luxembourg">Luxembourg</option>
                  <option value="Macao">Macao</option>
                  <option value="Macedonia, The Former Yugoslav Republic of">Macedonia, The Former Yugoslav Republic of</option>
                  <option value="Madagascar">Madagascar</option>
                  <option value="Malawi">Malawi</option>
                  <option value="Malaysia">Malaysia</option>
                  <option value="Maldives">Maldives</option>
                  <option value="Mali">Mali</option>
                  <option value="Malta">Malta</option>
                  <option value="Marshall Islands">Marshall Islands</option>
                  <option value="Martinique">Martinique</option>
                  <option value="Mauritania">Mauritania</option>
                  <option value="Mauritius">Mauritius</option>
                  <option value="Mayotte">Mayotte</option>
                  <option value="Mexico">Mexico</option>
                  <option value="Micronesia, Federated States of">Micronesia, Federated States of</option>
                  <option value="Moldova, Republic of">Moldova, Republic of</option>
                  <option value="Monaco">Monaco</option>
                  <option value="Mongolia">Mongolia</option>
                  <option value="Montserrat">Montserrat</option>
                  <option value="Morocco">Morocco</option>
                  <option value="Mozambique">Mozambique</option>
                  <option value="Myanmar">Myanmar</option>
                  <option value="Namibia">Namibia</option>
                  <option value="Nauru">Nauru</option>
                  <option value="Nepal">Nepal</option>
                  <option value="Netherlands">Netherlands</option>
                  <option value="Netherlands Antilles">Netherlands Antilles</option>
                  <option value="New Caledonia">New Caledonia</option>
                  <option value="New Zealand">New Zealand</option>
                  <option value="Nicaragua">Nicaragua</option>
                  <option value="Niger">Niger</option>
                  <option value="Nigeria">Nigeria</option>
                  <option value="Niue">Niue</option>
                  <option value="Norfolk Island">Norfolk Island</option>
                  <option value="Northern Mariana Islands">Northern Mariana Islands</option>
                  <option value="Norway">Norway</option>
                  <option value="Oman">Oman</option>
                  <option value="Pakistan">Pakistan</option>
                  <option value="Palau">Palau</option>
                  <option value="Palestinian Territory, Occupied">Palestinian Territory, Occupied</option>
                  <option value="Panama">Panama</option>
                  <option value="Papua New Guinea">Papua New Guinea</option>
                  <option value="Paraguay">Paraguay</option>
                  <option value="Peru">Peru</option>
                  <option value="Philippines">Philippines</option>
                  <option value="Pitcairn">Pitcairn</option>
                  <option value="Poland">Poland</option>
                  <option value="Portugal">Portugal</option>
                  <option value="Puerto Rico">Puerto Rico</option>
                  <option value="Qatar">Qatar</option>
                  <option value="Reunion">Reunion</option>
                  <option value="Romania">Romania</option>
                  <option value="Russian Federation">Russian Federation</option>
                  <option value="Rwanda">Rwanda</option>
                  <option value="Saint Helena">Saint Helena</option>
                  <option value="Saint Kitts and Nevis">Saint Kitts and Nevis</option>
                  <option value="Saint Lucia">Saint Lucia</option>
                  <option value="Saint Pierre and Miquelon">Saint Pierre and Miquelon</option>
                  <option value="Saint Vincent and the Grenadines">Saint Vincent and the Grenadines</option>
                  <option value="Samoa">Samoa</option>
                  <option value="San Marino">San Marino</option>
                  <option value="Sao Tome and Principe">Sao Tome and Principe</option>
                  <option value="Saudi Arabia">Saudi Arabia</option>
                  <option value="Senegal">Senegal</option>
                  <option value="Serbia and Montenegro">Serbia and Montenegro</option>
                  <option value="Seychelles">Seychelles</option>
                  <option value="Sierra Leone">Sierra Leone</option>
                  <option value="Singapore">Singapore</option>
                  <option value="Slovakia">Slovakia</option>
                  <option value="Slovenia">Slovenia</option>
                  <option value="Solomon Islands">Solomon Islands</option>
                  <option value="Somalia">Somalia</option>
                  <option value="South Africa">South Africa</option>
                  <option value="South Georgia and the South Sandwich Islands">South Georgia and the South Sandwich Islands</option>
                  <option value="Spain">Spain</option>
                  <option value="Sri Lanka">Sri Lanka</option>
                  <option value="Sudan">Sudan</option>
                  <option value="Suriname">Suriname</option>
                  <option value="Svalbard and Jan Mayen">Svalbard and Jan Mayen</option>
                  <option value="Swaziland">Swaziland</option>
                  <option value="Sweden">Sweden</option>
                  <option value="Switzerland">Switzerland</option>
                  <option value="Syrian Arab Republic">Syrian Arab Republic</option>
                  <option value="Taiwan, Province of China">Taiwan, Province of China</option>
                  <option value="Tajikistan">Tajikistan</option>
                  <option value="Tanzania, United Republic of">Tanzania, United Republic of</option>
                  <option value="Thailand">Thailand</option>
                  <option value="Timor-Leste">Timor-Leste</option>
                  <option value="Togo">Togo</option>
                  <option value="Tokelau">Tokelau</option>
                  <option value="Tonga">Tonga</option>
                  <option value="Trinidad and Tobago">Trinidad and Tobago</option>
                  <option value="Tunisia">Tunisia</option>
                  <option value="Turkey">Turkey</option>
                  <option value="Turkmenistan">Turkmenistan</option>
                  <option value="Turks and Caicos Islands">Turks and Caicos Islands</option>
                  <option value="Tuvalu">Tuvalu</option>
                  <option value="Uganda">Uganda</option>
                  <option value="Ukraine">Ukraine</option>
                  <option value="United Arab Emirates">United Arab Emirates</option>
                  <option value="United Kingdom">United Kingdom</option>
                  <option value="Uruguay">Uruguay</option>
                  <option value="Uzbekistan">Uzbekistan</option>
                  <option value="Vanuatu">Vanuatu</option>
                  <option value="Venezuela">Venezuela</option>
                  <option value="Viet Nam">Viet Nam</option>
                  <option value="Virgin Islands, British">Virgin Islands, British</option>
                  <option value="Virgin Islands, U.S.">Virgin Islands, U.S.</option>
                  <option value="Wallis and Futuna">Wallis and Futuna</option>
                  <option value="Western Sahara">Western Sahara</option>
                  <option value="Yemen">Yemen</option>
                  <option value="Zambia">Zambia</option>
                  <option value="Zimbabwe">Zimbabwe</option>
                </select>
                <div class="text-block-2">*Required Fields</div>
              </div>
              <div class="form-button">
                <a href="#" class="button-primary get-started next w-button">NEXT</a>
                <div data-w-id="2de1599f-5812-3e9d-6995-b996dd1130d5" class="div-block back"></div>
                <div data-w-id="28847f37-29f5-013d-65e4-551ac67feb92" class="div-block">NEXT</div><input type="submit" data-wait="Please wait..." class="submit-button w-button" value="SUBMIT">
              </div>
            </div>
          </div>
        </div>
        <div data-w-id="26450b76-0806-e9bb-0aac-3eb37cc85f63" class="form-slider-step-1 step-2 step-3 step-4">
          <div class="form-title">
            <div class="text-block">Memorios Obituary Writer</div>
            <h1 class="heading-2">When Were They Born?</h1>
          </div>
          <div class="form-bubbles">
            <div class="bubble-container">
              <p class="paragraph">Every story begins with a sunrise. Sharing when and where your loved one was born helps us paint a fuller picture of the life they lived and the joy they brought into the world.</p>
            </div>
          </div>
          <div class="form-questions">
            <div class="form-box">
              <div class="form-fields"><label for="date_of_birth" class="field-label">Please provide more details about their birth.</label>
                <div class="date-input-group">
                  <select name="month_of_birth" data-name="month_of_birth" id="month_of_birth" class="select-field w-select" required>
                    <option value="">Month*</option>
                    <option value="01">January</option>
                    <option value="02">February</option>
                    <option value="03">March</option>
                    <option value="04">April</option>
                    <option value="05">May</option>
                    <option value="06">June</option>
                    <option value="07">July</option>
                    <option value="08">August</option>
                    <option value="09">September</option>
                    <option value="10">October</option>
                    <option value="11">November</option>
                    <option value="12">December</option>
                  </select>
                  <select name="day_of_birth" data-name="day_of_birth" id="day_of_birth" class="select-field w-select" required>
                    <option value="">Day*</option>
                    <option value="01">1</option><option value="02">2</option><option value="03">3</option><option value="04">4</option><option value="05">5</option>
                    <option value="06">6</option><option value="07">7</option><option value="08">8</option><option value="09">9</option><option value="10">10</option>
                    <option value="11">11</option><option value="12">12</option><option value="13">13</option><option value="14">14</option><option value="15">15</option>
                    <option value="16">16</option><option value="17">17</option><option value="18">18</option><option value="19">19</option><option value="20">20</option>
                    <option value="21">21</option><option value="22">22</option><option value="23">23</option><option value="24">24</option><option value="25">25</option>
                    <option value="26">26</option><option value="27">27</option><option value="28">28</option><option value="29">29</option><option value="30">30</option>
                    <option value="31">31</option>
                  </select>
                  <select name="year_of_birth" data-name="year_of_birth" id="year_of_birth" class="select-field w-select" required>
                    <option value="">Year*</option>
                    <option value="2025">2025</option><option value="2024">2024</option><option value="2023">2023</option><option value="2022">2022</option><option value="2021">2021</option>
                    <option value="2020">2020</option><option value="2019">2019</option><option value="2018">2018</option><option value="2017">2017</option><option value="2016">2016</option>
                    <option value="2015">2015</option><option value="2014">2014</option><option value="2013">2013</option><option value="2012">2012</option><option value="2011">2011</option>
                    <option value="2010">2010</option><option value="2009">2009</option><option value="2008">2008</option><option value="2007">2007</option><option value="2006">2006</option>
                    <option value="2005">2005</option><option value="2004">2004</option><option value="2003">2003</option><option value="2002">2002</option><option value="2001">2001</option>
                    <option value="2000">2000</option><option value="1999">1999</option><option value="1998">1998</option><option value="1997">1997</option><option value="1996">1996</option>
                    <option value="1995">1995</option><option value="1994">1994</option><option value="1993">1993</option><option value="1992">1992</option><option value="1991">1991</option>
                    <option value="1990">1990</option><option value="1989">1989</option><option value="1988">1988</option><option value="1987">1987</option><option value="1986">1986</option>
                    <option value="1985">1985</option><option value="1984">1984</option><option value="1983">1983</option><option value="1982">1982</option><option value="1981">1981</option>
                    <option value="1980">1980</option><option value="1979">1979</option><option value="1978">1978</option><option value="1977">1977</option><option value="1976">1976</option>
                    <option value="1975">1975</option><option value="1974">1974</option><option value="1973">1973</option><option value="1972">1972</option><option value="1971">1971</option>
                    <option value="1970">1970</option><option value="1969">1969</option><option value="1968">1968</option><option value="1967">1967</option><option value="1966">1966</option>
                    <option value="1965">1965</option><option value="1964">1964</option><option value="1963">1963</option><option value="1962">1962</option><option value="1961">1961</option>
                    <option value="1960">1960</option><option value="1959">1959</option><option value="1958">1958</option><option value="1957">1957</option><option value="1956">1956</option>
                    <option value="1955">1955</option><option value="1954">1954</option><option value="1953">1953</option><option value="1952">1952</option><option value="1951">1951</option>
                    <option value="1950">1950</option><option value="1949">1949</option><option value="1948">1948</option><option value="1947">1947</option><option value="1946">1946</option>
                    <option value="1945">1945</option><option value="1944">1944</option><option value="1943">1943</option><option value="1942">1942</option><option value="1941">1941</option>
                    <option value="1940">1940</option><option value="1939">1939</option><option value="1938">1938</option><option value="1937">1937</option><option value="1936">1936</option>
                    <option value="1935">1935</option><option value="1934">1934</option><option value="1933">1933</option><option value="1932">1932</option><option value="1931">1931</option>
                    <option value="1930">1930</option><option value="1929">1929</option><option value="1928">1928</option><option value="1927">1927</option><option value="1926">1926</option>
                    <option value="1925">1925</option><option value="1924">1924</option><option value="1923">1923</option><option value="1922">1922</option><option value="1921">1921</option>
                    <option value="1920">1920</option><option value="1919">1919</option><option value="1918">1918</option><option value="1917">1917</option><option value="1916">1916</option>
                    <option value="1915">1915</option><option value="1914">1914</option><option value="1913">1913</option><option value="1912">1912</option><option value="1911">1911</option>
                    <option value="1910">1910</option><option value="1909">1909</option><option value="1908">1908</option><option value="1907">1907</option><option value="1906">1906</option>
                    <option value="1905">1905</option><option value="1904">1904</option><option value="1903">1903</option><option value="1902">1902</option><option value="1901">1901</option>
                    <option value="1900">1900</option>
                  </select>
                </div>
                <input class="text-field w-input" maxlength="256" name="city_of_birth" data-name="city_of_birth" placeholder="City of Birth*" type="text" id="city_of_birth" required="">
                <input class="text-field w-input" maxlength="256" name="state_of_birth" data-name="state_of_birth" placeholder="State of Birth" type="text" id="state_of_birth">
                <select name="country_of_birth" data-name="country_of_birth" id="country_of_birth" class="select-field w-select" required>
                  <option value="">Country of Birth*</option>
                  <option value="United States">United States</option>
                  <option value="Afghanistan">Afghanistan</option>
                  <option value="Albania">Albania</option>
                  <option value="Algeria">Algeria</option>
                  <option value="American Samoa">American Samoa</option>
                  <option value="Andorra">Andorra</option>
                  <option value="Angola">Angola</option>
                  <option value="Anguilla">Anguilla</option>
                  <option value="Antarctica">Antarctica</option>
                  <option value="Antigua and Barbuda">Antigua and Barbuda</option>
                  <option value="Argentina">Argentina</option>
                  <option value="Armenia">Armenia</option>
                  <option value="Aruba">Aruba</option>
                  <option value="Australia">Australia</option>
                  <option value="Austria">Austria</option>
                  <option value="Azerbaijan">Azerbaijan</option>
                  <option value="Bahamas">Bahamas</option>
                  <option value="Bahrain">Bahrain</option>
                  <option value="Bangladesh">Bangladesh</option>
                  <option value="Barbados">Barbados</option>
                  <option value="Belarus">Belarus</option>
                  <option value="Belgium">Belgium</option>
                  <option value="Belize">Belize</option>
                  <option value="Benin">Benin</option>
                  <option value="Bermuda">Bermuda</option>
                  <option value="Bhutan">Bhutan</option>
                  <option value="Bolivia">Bolivia</option>
                  <option value="Bosnia and Herzegovina">Bosnia and Herzegovina</option>
                  <option value="Botswana">Botswana</option>
                  <option value="Bouvet Island">Bouvet Island</option>
                  <option value="Brazil">Brazil</option>
                  <option value="British Indian Ocean Territory">British Indian Ocean Territory</option>
                  <option value="Brunei Darussalam">Brunei Darussalam</option>
                  <option value="Bulgaria">Bulgaria</option>
                  <option value="Burkina Faso">Burkina Faso</option>
                  <option value="Burundi">Burundi</option>
                  <option value="Cambodia">Cambodia</option>
                  <option value="Cameroon">Cameroon</option>
                  <option value="Canada">Canada</option>
                  <option value="Cape Verde">Cape Verde</option>
                  <option value="Cayman Islands">Cayman Islands</option>
                  <option value="Central African Republic">Central African Republic</option>
                  <option value="Chad">Chad</option>
                  <option value="Chile">Chile</option>
                  <option value="China">China</option>
                  <option value="Christmas Island">Christmas Island</option>
                  <option value="Cocos (Keeling) Islands">Cocos (Keeling) Islands</option>
                  <option value="Colombia">Colombia</option>
                  <option value="Comoros">Comoros</option>
                  <option value="Congo">Congo</option>
                  <option value="Congo, The Democratic Republic of the">Congo, The Democratic Republic of the</option>
                  <option value="Cook Islands">Cook Islands</option>
                  <option value="Costa Rica">Costa Rica</option>
                  <option value="Cote D'Ivoire">Cote D'Ivoire</option>
                  <option value="Croatia">Croatia</option>
                  <option value="Cuba">Cuba</option>
                  <option value="Cyprus">Cyprus</option>
                  <option value="Czech Republic">Czech Republic</option>
                  <option value="Denmark">Denmark</option>
                  <option value="Djibouti">Djibouti</option>
                  <option value="Dominica">Dominica</option>
                  <option value="Dominican Republic">Dominican Republic</option>
                  <option value="Ecuador">Ecuador</option>
                  <option value="Egypt">Egypt</option>
                  <option value="El Salvador">El Salvador</option>
                  <option value="Equatorial Guinea">Equatorial Guinea</option>
                  <option value="Eritrea">Eritrea</option>
                  <option value="Estonia">Estonia</option>
                  <option value="Ethiopia">Ethiopia</option>
                  <option value="Falkland Islands (Malvinas)">Falkland Islands (Malvinas)</option>
                  <option value="Faroe Islands">Faroe Islands</option>
                  <option value="Fiji">Fiji</option>
                  <option value="Finland">Finland</option>
                  <option value="France">France</option>
                  <option value="French Guiana">French Guiana</option>
                  <option value="French Polynesia">French Polynesia</option>
                  <option value="French Southern Territories">French Southern Territories</option>
                  <option value="Gabon">Gabon</option>
                  <option value="Gambia">Gambia</option>
                  <option value="Georgia">Georgia</option>
                  <option value="Germany">Germany</option>
                  <option value="Ghana">Ghana</option>
                  <option value="Gibraltar">Gibraltar</option>
                  <option value="Greece">Greece</option>
                  <option value="Greenland">Greenland</option>
                  <option value="Grenada">Grenada</option>
                  <option value="Guadeloupe">Guadeloupe</option>
                  <option value="Guam">Guam</option>
                  <option value="Guatemala">Guatemala</option>
                  <option value="Guernsey">Guernsey</option>
                  <option value="Guinea">Guinea</option>
                  <option value="Guinea-Bissau">Guinea-Bissau</option>
                  <option value="Guyana">Guyana</option>
                  <option value="Haiti">Haiti</option>
                  <option value="Heard Island and Mcdonald Islands">Heard Island and Mcdonald Islands</option>
                  <option value="Holy See (Vatican City State)">Holy See (Vatican City State)</option>
                  <option value="Honduras">Honduras</option>
                  <option value="Hong Kong">Hong Kong</option>
                  <option value="Hungary">Hungary</option>
                  <option value="Iceland">Iceland</option>
                  <option value="India">India</option>
                  <option value="Indonesia">Indonesia</option>
                  <option value="Iran, Islamic Republic Of">Iran, Islamic Republic Of</option>
                  <option value="Iraq">Iraq</option>
                  <option value="Ireland">Ireland</option>
                  <option value="Isle of Man">Isle of Man</option>
                  <option value="Israel">Israel</option>
                  <option value="Italy">Italy</option>
                  <option value="Jamaica">Jamaica</option>
                  <option value="Japan">Japan</option>
                  <option value="Jersey">Jersey</option>
                  <option value="Jordan">Jordan</option>
                  <option value="Kazakhstan">Kazakhstan</option>
                  <option value="Kenya">Kenya</option>
                  <option value="Kiribati">Kiribati</option>
                  <option value="Korea, Democratic People'S Republic of">Korea, Democratic People'S Republic of</option>
                  <option value="Korea, Republic of">Korea, Republic of</option>
                  <option value="Kuwait">Kuwait</option>
                  <option value="Kyrgyzstan">Kyrgyzstan</option>
                  <option value="Lao People'S Democratic Republic">Lao People'S Democratic Republic</option>
                  <option value="Latvia">Latvia</option>
                  <option value="Lebanon">Lebanon</option>
                  <option value="Lesotho">Lesotho</option>
                  <option value="Liberia">Liberia</option>
                  <option value="Libyan Arab Jamahiriya">Libyan Arab Jamahiriya</option>
                  <option value="Liechtenstein">Liechtenstein</option>
                  <option value="Lithuania">Lithuania</option>
                  <option value="Luxembourg">Luxembourg</option>
                  <option value="Macao">Macao</option>
                  <option value="Macedonia, The Former Yugoslav Republic of">Macedonia, The Former Yugoslav Republic of</option>
                  <option value="Madagascar">Madagascar</option>
                  <option value="Malawi">Malawi</option>
                  <option value="Malaysia">Malaysia</option>
                  <option value="Maldives">Maldives</option>
                  <option value="Mali">Mali</option>
                  <option value="Malta">Malta</option>
                  <option value="Marshall Islands">Marshall Islands</option>
                  <option value="Martinique">Martinique</option>
                  <option value="Mauritania">Mauritania</option>
                  <option value="Mauritius">Mauritius</option>
                  <option value="Mayotte">Mayotte</option>
                  <option value="Mexico">Mexico</option>
                  <option value="Micronesia, Federated States of">Micronesia, Federated States of</option>
                  <option value="Moldova, Republic of">Moldova, Republic of</option>
                  <option value="Monaco">Monaco</option>
                  <option value="Mongolia">Mongolia</option>
                  <option value="Montserrat">Montserrat</option>
                  <option value="Morocco">Morocco</option>
                  <option value="Mozambique">Mozambique</option>
                  <option value="Myanmar">Myanmar</option>
                  <option value="Namibia">Namibia</option>
                  <option value="Nauru">Nauru</option>
                  <option value="Nepal">Nepal</option>
                  <option value="Netherlands">Netherlands</option>
                  <option value="Netherlands Antilles">Netherlands Antilles</option>
                  <option value="New Caledonia">New Caledonia</option>
                  <option value="New Zealand">New Zealand</option>
                  <option value="Nicaragua">Nicaragua</option>
                  <option value="Niger">Niger</option>
                  <option value="Nigeria">Nigeria</option>
                  <option value="Niue">Niue</option>
                  <option value="Norfolk Island">Norfolk Island</option>
                  <option value="Northern Mariana Islands">Northern Mariana Islands</option>
                  <option value="Norway">Norway</option>
                  <option value="Oman">Oman</option>
                  <option value="Pakistan">Pakistan</option>
                  <option value="Palau">Palau</option>
                  <option value="Palestinian Territory, Occupied">Palestinian Territory, Occupied</option>
                  <option value="Panama">Panama</option>
                  <option value="Papua New Guinea">Papua New Guinea</option>
                  <option value="Paraguay">Paraguay</option>
                  <option value="Peru">Peru</option>
                  <option value="Philippines">Philippines</option>
                  <option value="Pitcairn">Pitcairn</option>
                  <option value="Poland">Poland</option>
                  <option value="Portugal">Portugal</option>
                  <option value="Puerto Rico">Puerto Rico</option>
                  <option value="Qatar">Qatar</option>
                  <option value="Reunion">Reunion</option>
                  <option value="Romania">Romania</option>
                  <option value="Russian Federation">Russian Federation</option>
                  <option value="Rwanda">Rwanda</option>
                  <option value="Saint Helena">Saint Helena</option>
                  <option value="Saint Kitts and Nevis">Saint Kitts and Nevis</option>
                  <option value="Saint Lucia">Saint Lucia</option>
                  <option value="Saint Pierre and Miquelon">Saint Pierre and Miquelon</option>
                  <option value="Saint Vincent and the Grenadines">Saint Vincent and the Grenadines</option>
                  <option value="Samoa">Samoa</option>
                  <option value="San Marino">San Marino</option>
                  <option value="Sao Tome and Principe">Sao Tome and Principe</option>
                  <option value="Saudi Arabia">Saudi Arabia</option>
                  <option value="Senegal">Senegal</option>
                  <option value="Serbia and Montenegro">Serbia and Montenegro</option>
                  <option value="Seychelles">Seychelles</option>
                  <option value="Sierra Leone">Sierra Leone</option>
                  <option value="Singapore">Singapore</option>
                  <option value="Slovakia">Slovakia</option>
                  <option value="Slovenia">Slovenia</option>
                  <option value="Solomon Islands">Solomon Islands</option>
                  <option value="Somalia">Somalia</option>
                  <option value="South Africa">South Africa</option>
                  <option value="South Georgia and the South Sandwich Islands">South Georgia and the South Sandwich Islands</option>
                  <option value="Spain">Spain</option>
                  <option value="Sri Lanka">Sri Lanka</option>
                  <option value="Sudan">Sudan</option>
                  <option value="Suriname">Suriname</option>
                  <option value="Svalbard and Jan Mayen">Svalbard and Jan Mayen</option>
                  <option value="Swaziland">Swaziland</option>
                  <option value="Sweden">Sweden</option>
                  <option value="Switzerland">Switzerland</option>
                  <option value="Syrian Arab Republic">Syrian Arab Republic</option>
                  <option value="Taiwan, Province of China">Taiwan, Province of China</option>
                  <option value="Tajikistan">Tajikistan</option>
                  <option value="Tanzania, United Republic of">Tanzania, United Republic of</option>
                  <option value="Thailand">Thailand</option>
                  <option value="Timor-Leste">Timor-Leste</option>
                  <option value="Togo">Togo</option>
                  <option value="Tokelau">Tokelau</option>
                  <option value="Tonga">Tonga</option>
                  <option value="Trinidad and Tobago">Trinidad and Tobago</option>
                  <option value="Tunisia">Tunisia</option>
                  <option value="Turkey">Turkey</option>
                  <option value="Turkmenistan">Turkmenistan</option>
                  <option value="Turks and Caicos Islands">Turks and Caicos Islands</option>
                  <option value="Tuvalu">Tuvalu</option>
                  <option value="Uganda">Uganda</option>
                  <option value="Ukraine">Ukraine</option>
                  <option value="United Arab Emirates">United Arab Emirates</option>
                  <option value="United Kingdom">United Kingdom</option>
                  <option value="Uruguay">Uruguay</option>
                  <option value="Uzbekistan">Uzbekistan</option>
                  <option value="Vanuatu">Vanuatu</option>
                  <option value="Venezuela">Venezuela</option>
                  <option value="Viet Nam">Viet Nam</option>
                  <option value="Virgin Islands, British">Virgin Islands, British</option>
                  <option value="Virgin Islands, U.S.">Virgin Islands, U.S.</option>
                  <option value="Wallis and Futuna">Wallis and Futuna</option>
                  <option value="Western Sahara">Western Sahara</option>
                  <option value="Yemen">Yemen</option>
                  <option value="Zambia">Zambia</option>
                  <option value="Zimbabwe">Zimbabwe</option>
                </select>
                <div class="text-block-2">*Required Fields</div>
              </div>
              <div class="form-button">
                <a href="#" class="button-primary get-started next w-button">NEXT</a>
                <div data-w-id="f007f144-8a21-38fa-ee87-7b0eaa1e0652" class="div-block back"></div>
                <div data-w-id="c349bb20-e988-f2a2-0a7c-732b821143a1" class="div-block">NEXT</div><input type="submit" data-wait="Please wait..." class="submit-button w-button" value="SUBMIT">
              </div>
            </div>
          </div>
        </div>
        <div data-w-id="fc28afd3-7120-57b6-fb8d-5fad1910908f" class="form-slider-step-1 step-2 step-3 step-4">
          <div class="form-title">
            <div class="text-block">Memorios Obituary Writer</div>
            <h1 class="heading-2">Where Will the Funeral or Memorial Service Be Held?</h1>
          </div>
          <div class="form-bubbles">
            <div class="bubble-container">
              <p class="paragraph">This small detail ensures their memory is honored with dignity and helps loved ones know where they can come together in remembrance.</p>
            </div>
          </div>
          <div class="form-questions">
            <div class="form-box">
              <div class="form-fields"><label for="funeral_home" class="field-label">Name of the funeral home?</label><input class="text-field w-input" maxlength="256" name="funeral_home" data-name="funeral_home" placeholder="Funeral Home*" type="text" id="funeral_home" required="">
                <div class="text-block-2">*Required Fields</div>
              </div>
              <div class="form-button">
                <a href="#" class="button-primary get-started next w-button">NEXT</a>
                <div data-w-id="f160af2a-396f-8a06-a9e2-6b986ca5064d" class="div-block back"></div>
                <div data-w-id="9a92fba4-e4a0-0c78-c9db-d90baab8707d" class="div-block">NEXT</div><input type="submit" data-wait="Please wait..." class="submit-button w-button" value="SUBMIT">
              </div>
            </div>
          </div>
        </div>
        <div data-w-id="fc0a8b98-fbbd-79d8-65f0-f4ae52dcb201" class="form-slider-step-1 step-2 step-3 step-4 checklist-step6 upload">
          <div class="form-title">
            <div class="text-block">Memorios Obituary Writer</div>
            <h1 class="heading-2">Visualize Your Loved Ones Story</h1>
          </div>
          <div class="form-bubbles">
            <div class="bubble-container">
              <p class="paragraph"><em class="italic-text">Every life is a collection of beautiful moments. Upload photos to help us honor your loved one’s journey.</em></p>
            </div>
          </div>
          <div class="form-questions">
            <div class="form-box optionals">
              <div class="form-fields">
                <label for="photo_upload" class="field-label">Upload your images below</label>
                <div style="margin-bottom: 20px;">
                  <input 
                    type="file" 
                    id="photo_upload" 
                    name="photo_upload" 
                    accept="image/*" 
                    multiple 
                    style="display: none;">
                  <button 
                    type="button" 
                    onclick="document.getElementById('photo_upload').click()" 
                    class="button" 
                    style="padding: 12px 24px; margin-bottom: 10px;">
                    📷 Select Photos
                  </button>
                  <div id="photo-preview" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 10px; margin-top: 15px;"></div>
                </div>
                <label for="tribute_quote" class="field-label quote">Is there a favorite quote, verse, or saying you&#x27;d like us to include in the tribute video?</label>
                <textarea placeholder="Something they always said or something that reminds you of them and captures their spirit." maxlength="5000" id="tribute_quote" name="tribute_quote" data-name="tribute_quote" class="textarea tribute w-input"></textarea>
                <div class="text-block-2">*Required Fields</div>
              </div>
              <div class="form-button">
                <a href="#" class="button-primary get-started next w-button">NEXT</a>
                <div data-w-id="fc0a8b98-fbbd-79d8-65f0-f4ae52dcb217" class="div-block back"></div><input type="submit" data-wait="Please wait..." class="submit-button w-button" value="SUBMIT">
                <div data-w-id="fc0a8b98-fbbd-79d8-65f0-f4ae52dcb219" class="div-block">Next</div>
              </div>
            </div>
          </div>
        </div>
        <div data-w-id="fe767c75-255d-9930-5bf8-034b8f1e0a31" class="form-slider-step-1 step-2 step-3 step-4 finalcheck-step7">
          <div class="form-title">
            <div class="text-block">Memorios Obituary Writer</div>
            <h1 class="heading-2">Would You Like to Add Any Special Details?</h1>
          </div>
          <div class="form-bubbles">
            <div class="bubble-container">
              <p class="paragraph">Almost done, just review the information and add any final details of your choice. Once you submit your obituary will be created.</p>
            </div>
          </div>
          <div class="form-questions">
            <div class="form-box optional">
              <div class="form-fields"><label for="final_details" class="field-label final">Is there anything else you want to include in the Obituary?</label>
                <div class="faq-container form-accordion">
                  <div class="faq-item">
                    <div class="faq-title">
                      <div class="text-block-3"><strong>Family Members</strong></div><img data-w-id="355de858-8660-8848-d84b-14932cd1c054" loading="lazy" alt="" src="images/chevron-down-solid-full.svg" class="faq-item-icon">
                      <div data-w-id="5291f307-65ce-4239-023b-a9d65d8512ce" class="div-block accordion save">Save</div>
                      <div data-w-id="e3e1811b-d293-684d-c4c9-f12023ec2623" class="div-block accordion _1">Add</div>
                    </div>
                    <div class="faq-body">
                      <div class="faq-body-inner">
                        <div class="form-fields"><label for="family_members" class="field-label accordion">Who were the important people in their life?</label><textarea id="family_members" name="family_members" maxlength="5000" data-name="family_members" placeholder="Please share the names of parents, siblings, children, close relatives, or dear friends who were important in their life." class="textarea w-input"></textarea></div>
                      </div>
                    </div>
                  </div>
                  <div class="faq-item">
                    <div class="faq-title">
                      <div class="text-block-3">Personal Details</div><img data-w-id="4f9a1331-d813-e52d-e502-604643707e72" loading="lazy" alt="" src="images/chevron-down-solid-full.svg" class="faq-item-icon">
                      <div data-w-id="4f9a1331-d813-e52d-e502-604643707e73" class="div-block accordion save">Save</div>
                      <div data-w-id="4f9a1331-d813-e52d-e502-604643707e75" class="div-block accordion _1">Add</div>
                    </div>
                    <div class="faq-body">
                      <div class="faq-body-inner">
                        <div class="form-fields"><label for="loved_ones_age" class="field-label accordion">How old were they?</label><input class="text-field w-input" maxlength="256" name="loved_ones_age" data-name="loved_ones_age" placeholder="Age" type="text" id="loved_ones_age"><label for="loved_ones_description" class="field-label accordion">Describe them as a person</label><textarea id="loved_ones_description" name="loved_ones_description" maxlength="5000" data-name="loved_ones_description" placeholder="What were they known for by loved ones?" class="textarea w-input"></textarea></div>
                      </div>
                    </div>
                  </div>
                  <div class="faq-item">
                    <div class="faq-title">
                      <div class="text-block-3">Education</div><img data-w-id="355de858-8660-8848-d84b-14932cd1c05d" loading="lazy" alt="" src="images/chevron-down-solid-full.svg" class="faq-item-icon">
                      <div data-w-id="19bacba2-bf89-2428-730e-a4fe87d1a4f8" class="div-block accordion save">Save</div>
                      <div data-w-id="a6781175-ee91-77bb-6574-ac8127e6a6c2" class="div-block accordion _2">Add</div>
                    </div>
                    <div class="faq-body">
                      <div class="faq-body-inner">
                        <div class="form-fields"><label for="loved_ones_achievements" class="field-label accordion">What were their achievements?</label><textarea id="loved_ones_achievements" name="loved_ones_achievements" maxlength="5000" data-name="loved_ones_achievements" placeholder="List the name and location of schools they attended. Include degrees, certificates, or special honors they received. " class="textarea w-input"></textarea></div>
                      </div>
                    </div>
                  </div>
                  <div class="faq-item">
                    <div class="faq-title">
                      <div class="text-block-3">Hobbies / Interests</div><img data-w-id="355de858-8660-8848-d84b-14932cd1c066" loading="lazy" alt="" src="images/chevron-down-solid-full.svg" class="faq-item-icon">
                      <div data-w-id="fdde6dd8-6663-9c97-df3e-2be9edee57b3" class="div-block accordion save">Save</div>
                      <div data-w-id="b9d1a5dc-e3a8-3583-4591-caffaec5cecc" class="div-block accordion _3">Add</div>
                    </div>
                    <div class="faq-body">
                      <div class="faq-body-inner">
                        <div class="form-fields"><label for="loved_ones_hobbies" class="field-label accordion">What stood out to them?</label><textarea id="loved_ones_hobbies" name="loved_ones_hobbies" maxlength="5000" data-name="loved_ones_hobbies" placeholder="List activities that or interests that were important to your loved one." class="textarea w-input"></textarea></div>
                      </div>
                    </div>
                  </div>
                  <div class="faq-item">
                    <div class="faq-title">
                      <div class="text-block-3">Career Highlights</div><img data-w-id="355de858-8660-8848-d84b-14932cd1c06f" loading="lazy" alt="" src="images/chevron-down-solid-full.svg" class="faq-item-icon">
                      <div data-w-id="e450d333-1505-1d82-8d8e-da1ac73ca050" class="div-block accordion save">Save</div>
                      <div data-w-id="64dc0735-4929-d17f-182d-2f9100c58609" class="div-block accordion _4">Add</div>
                    </div>
                    <div class="faq-body">
                      <div class="faq-body-inner">
                        <div class="form-fields"><label for="loved_ones_career" class="field-label accordion">Tell us about their career highlights</label><textarea id="loved_ones_career" name="loved_ones_career" maxlength="5000" data-name="loved_ones_career" placeholder="List work experience and any related accomplishments. Feel free to include dates and proud moments." class="textarea w-input"></textarea></div>
                      </div>
                    </div>
                  </div>
                  <div class="faq-item">
                    <div class="faq-title">
                      <div class="text-block-3">Religion / Spirituality</div><img data-w-id="355de858-8660-8848-d84b-14932cd1c078" loading="lazy" alt="" src="images/chevron-down-solid-full.svg" class="faq-item-icon">
                      <div data-w-id="44d8c571-cad4-6b83-7a3d-2f27a98fd88d" class="div-block accordion save">Save</div>
                      <div data-w-id="da074825-a62f-729f-cc75-75370d9dd7b8" class="div-block accordion _5">Add</div>
                    </div>
                    <div class="faq-body">
                      <div class="faq-body-inner">
                        <div class="form-fields"><label for="loved_ones_spiritual_beliefs" class="field-label accordion">What role did religion or spirituality have in their life?</label><textarea id="loved_ones_spiritual_beliefs" name="loved_ones_spiritual_beliefs" maxlength="5000" data-name="loved_ones_spiritual_beliefs" placeholder="List places of worship, acts of service, faith related travel, or important values your loved one held." class="textarea w-input"></textarea></div>
                      </div>
                    </div>
                  </div>
                  <div class="faq-item">
                    <div class="faq-title">
                      <div class="text-block-3">Military Service</div><img data-w-id="355de858-8660-8848-d84b-14932cd1c081" loading="lazy" alt="" src="images/chevron-down-solid-full.svg" class="faq-item-icon">
                      <div data-w-id="ad3b1aa2-21b3-5e5c-62ac-a000c09d3126" class="div-block accordion save">Save</div>
                      <div data-w-id="1390af09-89b7-9820-63d1-fa3d873fbed0" class="div-block accordion _6">Add</div>
                    </div>
                    <div class="faq-body">
                      <div class="faq-body-inner">
                        <div class="form-fields"><label for="loved_ones_military_service" class="field-label accordion">Tell us about their military service</label><textarea id="loved_ones_military_service" name="loved_ones_military_service" maxlength="5000" data-name="loved_ones_military_service" placeholder="If they were a veteran, list the branch, rank, and time served, along with location." class="textarea w-input"></textarea></div>
                      </div>
                    </div>
                  </div>
                </div><label for="final_details" class="field-label finaldetails">Would you like to include any service or event information?</label><textarea placeholder="Add info about upcoming services: time, place, dress code, or anything guests should know." maxlength="5000" id="final_details" name="final_details" data-name="final_details" class="textarea w-input"></textarea>
              </div>
              <div class="form-button">
                <a href="#" class="button-primary get-started next w-button">NEXT</a>
                <div data-w-id="fe767c75-255d-9930-5bf8-034b8f1e0a46" class="div-block back"></div>
                <div class="div-block finaldetails">NEXT</div><input type="submit" data-wait="Please wait..." class="submit-button last-finaldetails w-button" value="SUBMIT">
              </div>
            </div>
          </div>
        </div>
      </form>
      <div class="success-message w-form-done">
        <div id="memorio-success-container">
          <!-- Success content will be injected here by JavaScript -->
        </div>
      </div>
      <div class="w-form-fail">
        <div>Oops! Something went wrong while submitting the form.</div>
      </div>
    </div>
  </div>
  <style id="memorio-styles">
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Dosis', sans-serif;
            background-color: #f4e8de;
            color: #32343a;
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 800px; margin: 0 auto; }
        /* Header is present in the DOM but fully hidden (kills black title/tagline) */
        .header { display: none !important; }
        .writing-status {
            background-color: #fff3e9;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 2px 8px -2px rgba(0,0,0,0.2);
            opacity: 1;
            transition: opacity 0.5s ease-out;
        }
        .writing-status.fade-out {
            opacity: 0;
        }
        .status-text { font-size: 18px; margin-bottom: 15px; color: #436481; }
        .loading-dots { display: inline-flex; gap: 5px; }
        .dot { width: 8px; height: 8px; background-color: #436481; border-radius: 50%; animation: pulse 1.5s infinite; }
        .dot:nth-child(2) { animation-delay: .3s; }
        .dot:nth-child(3) { animation-delay: .6s; }
        @keyframes pulse { 0%,100%{opacity:.3} 50%{opacity:1} }
        .obituary-card { 
            background-color:#fff3e9; 
            border-radius:20px; 
            padding:25px; 
            margin-bottom:30px; 
            box-shadow:0 2px 8px -2px rgba(0,0,0,.2); 
        }
        .obituary-title { font-size:18px; color:#436481; margin-bottom:20px; font-weight:500; border:none; }
        .edit-hint { 
            font-size: 13px; 
            color: #7a8592; 
            text-align: center; 
            margin-top: 15px; 
            margin-bottom: 15px;
            font-style: italic; 
            opacity: 0.7;
            transition: opacity 0.3s ease;
            cursor: default;
        }
        .edit-hint:hover { 
            opacity: 0.9; 
        }
        .obituary-content {
            font-size: 18px; line-height: 1.8; color: #32343a; min-height: 200px; cursor: text;
            background-color: #fff3e9; border-radius: 20px; padding: 25px; box-shadow: 0 2px 8px -2px rgba(0,0,0,.2);
            border: none; outline: none; margin-top: 15px; font-weight: 400; word-wrap: break-word; white-space: pre-wrap;
        }
        .obituary-content:focus { outline:none; border:none; box-shadow:0 2px 8px -2px rgba(0,0,0,.2); }
        .obituary-content::selection { background-color: rgba(67,100,129,.2); }
        .obituary-content p { margin-bottom:20px; font-size:18px; line-height:1.8; color:#32343a; font-weight:400; }
        .obituary-content p:last-child { margin-bottom:0; }
        .obituary-content[contenteditable="true"] { box-shadow: 0 2px 8px -2px rgba(67,100,129,.3); }
        .typewriter-cursor { display:inline-block; width:2px; height:22px; background:#32343a; animation: blink 1s infinite; vertical-align:text-top; margin-left:2px; }
        @keyframes blink { 0%,50%{opacity:1} 51%,100%{opacity:0} }
        .action-buttons { display:flex; justify-content:center; margin-top:30px; }
        .btn { background:#32343a; color:#fff; border:none; padding:15px 30px; font-size:16px; border-radius:60px; cursor:pointer; transition: all .3s ease; font-weight:500; }
        .btn:hover { background:#436481; transform: translateY(-2px); }
        .btn:disabled { background:#9ca3af; cursor: not-allowed; transform: none; }
        .hidden { display: none; }
        .fade-in { animation: fadeIn .5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px);} to { opacity:1; transform: translateY(0);} }
        .memorial-info { background:#fff3e9; border-radius:20px; padding:25px; margin-bottom:20px; font-size:16px; color:#32343a; text-align:center; box-shadow:0 2px 8px -2px rgba(0,0,0,.2); }
        .memorio-container { max-width: 800px; margin: 0 auto; }
    </style>
            <script>
        // Production endpoints - will work when deployed to memorio.ai domain
        const ENDPOINT = "https://memorioo.app.n8n.cloud/webhook/memorio-intake";
        const EMAIL_ENDPOINT = "https://memorioo.app.n8n.cloud/webhook/send-email";
        
        // For local development, uncomment these lines and comment out the above:
        // const ENDPOINT = "http://localhost:3001/webhook/memorio-intake";
        // const EMAIL_ENDPOINT = "http://localhost:3001/webhook/send-email";
        
        // ============================================================================
        // SUPABASE CONFIGURATION
        // ============================================================================
        const SUPABASE_URL = 'https://gkabtvqwwuvigcdubwyv.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdrYWJ0dnF3d3V2aWdjZHVid3l2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk5MDE5MjUsImV4cCI6MjA3NTQ3NzkyNX0.O1DfOR5FBm6r3Pg-tjEE5CkzRr3WlWqGU1xUYKrhtnU';
        const { createClient } = supabase;
        const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // Global variables for authenticated user and case
        let currentUser = null;
        let currentCase = null;
        let selectedPhotos = []; // Store selected photo files
        
        // Redirect lock to prevent infinite loops between index.html and dashboard.html
        const REDIRECT_LOCK_KEY = 'memorio-family-redirect-lock';
        const REDIRECT_LOCK_DURATION = 3000; // 3 seconds
        
        function canRedirect() {
            const lastRedirect = sessionStorage.getItem(REDIRECT_LOCK_KEY);
            if (lastRedirect) {
                const timeSinceRedirect = Date.now() - parseInt(lastRedirect);
                if (timeSinceRedirect < REDIRECT_LOCK_DURATION) {
                    console.warn('⚠️ Redirect blocked - too soon since last redirect');
                    return false;
                }
            }
            return true;
        }
        
        function setRedirectLock() {
            sessionStorage.setItem(REDIRECT_LOCK_KEY, Date.now().toString());
        }
        
        // ============================================================================
        // LOGIN MODAL FUNCTIONS
        // ============================================================================
        
        /**
         * Show login modal overlay
         */
        function showLoginModal() {
            const modal = document.getElementById('loginModal');
            if (modal) {
                modal.style.display = 'flex';
                // Hide the form while modal is showing
                const formSlider = document.querySelector('.form-slider-padding');
                if (formSlider) formSlider.style.display = 'none';
            }
        }
        
        /**
         * Hide login modal and show form
         */
        function hideLoginModal() {
            const modal = document.getElementById('loginModal');
            if (modal) {
                modal.style.display = 'none';
                // Show the form after successful login
                const formSlider = document.querySelector('.form-slider-padding');
                if (formSlider) formSlider.style.display = 'block';
            }
        }
        
        /**
         * Show password change modal (first-time login)
         */
        function showPasswordChangeModal() {
            const modal = document.getElementById('passwordChangeModal');
            if (modal) {
                modal.style.display = 'flex';
                // Hide both login modal and form
                hideLoginModal();
                const formSlider = document.querySelector('.form-slider-padding');
                if (formSlider) formSlider.style.display = 'none';
            }
        }
        
        /**
         * Hide password change modal
         */
        function hidePasswordChangeModal() {
            const modal = document.getElementById('passwordChangeModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }
        
        /**
         * Handle password change form submission (Same logic as Director Portal)
         */
        async function handlePasswordChange(e) {
            e.preventDefault();
            
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const changeBtn = document.getElementById('passwordChangeBtn');
            const errorMessage = document.getElementById('passwordChangeError');
            
            // Hide previous errors
            errorMessage.style.display = 'none';
            
            // Validate passwords match
            if (newPassword !== confirmPassword) {
                errorMessage.textContent = 'Passwords do not match. Please try again.';
                errorMessage.style.display = 'block';
                return;
            }
            
            // Validate password strength
            if (newPassword.length < 8) {
                errorMessage.textContent = 'Password must be at least 8 characters long.';
                errorMessage.style.display = 'block';
                return;
            }
            
            // Disable button and show loading
            changeBtn.disabled = true;
            changeBtn.textContent = 'Updating Password...';
            
            try {
                // Update password in Supabase Auth
                const { error: passwordError } = await supabaseClient.auth.updateUser({
                    password: newPassword
                });
                
                if (passwordError) throw passwordError;
                
                // Clear the requires_password_change flag in user metadata (same as Director Portal)
                const { data: { session } } = await supabaseClient.auth.getSession();
                if (!session) throw new Error('Session expired');
                
                const { error: metadataError } = await supabaseClient
                    .from('users')
                    .update({
                        metadata: {
                            ...currentUser?.metadata,
                            requires_password_change: false,
                            password_changed_at: new Date().toISOString()
                        }
                    })
                    .eq('id', session.user.id);
                
                if (metadataError) throw metadataError;
                
                console.log('✅ Password changed successfully');
                
                // Hide modal and continue to form
                hidePasswordChangeModal();
                
                // Show success message
                alert('Password updated successfully! You can now proceed with the form.');
                
                // Load the family case and continue
                await loadFamilyCase();
                
            } catch (error) {
                console.error('Password change error:', error);
                errorMessage.textContent = error.message || 'Failed to update password. Please try again.';
                errorMessage.style.display = 'block';
                
                // Re-enable button
                changeBtn.disabled = false;
                changeBtn.textContent = 'Set New Password';
            }
        }
        
        /**
         * Handle login form submission
         */
        async function handleLogin(e) {
            e.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const loginBtn = document.getElementById('loginBtn');
            const errorMessage = document.getElementById('loginError');
            
            // Hide previous errors
            errorMessage.style.display = 'none';
            
            // Disable button and show loading
            loginBtn.disabled = true;
            loginBtn.textContent = 'Signing in...';
            
            try {
                // Attempt login
                const { data, error } = await supabaseClient.auth.signInWithPassword({
                    email: email,
                    password: password
                });
                
                if (error) throw error;
                
                // Check if user is a family member
                const role = data.user.app_metadata?.role;
                
                if (role !== 'family') {
                    throw new Error('Access denied: This form is only for family members.');
                }
                
                // Fetch user data from database (EXACT same as Director Portal)
                const { data: userData, error: userError } = await supabaseClient
                    .from('users')
                    .select('role, metadata')
                    .eq('id', data.user.id)
                    .single();
                
                console.log('✅ Login successful:', data.user.email);
                console.log('🔐 Database user data:', userData);
                
                if (userError || !userData || userData.role !== 'family') {
                    throw new Error('Access denied: This form is only for family members.');
                }
                
                // Check if user needs to change password (EXACT same check as Director Portal)
                if (userData.metadata?.requires_password_change === true) {
                    console.log('⚠️ First login detected - forcing password change');
                    hideLoginModal();
                    showPasswordChangeModal();
                    return; // Stop execution until password is changed
                }
                
                // Set currentUser with full data
                currentUser = {
                    id: data.user.id,
                    email: data.user.email,
                    ...userData
                };
                
                // Fetch and display user's name for personalized greeting
                try {
                    const { data: userData, error: userError } = await supabaseClient
                        .from('users')
                        .select('metadata')
                        .eq('id', currentUser.id)
                        .single();
                    
                    if (!userError && userData?.metadata?.name) {
                        const userName = userData.metadata.name;
                        console.log('✅ User name loaded:', userName);
                        
                        // Update the welcome heading with personalized greeting
                        const welcomeHeading = document.getElementById('welcome-heading');
                        if (welcomeHeading) {
                            welcomeHeading.textContent = `Hey ${userName}, Let's begin.`;
                        }
                    } else {
                        // Fallback to JWT user_metadata
                        const fallbackName = currentUser.user_metadata?.name;
                        if (fallbackName) {
                            const welcomeHeading = document.getElementById('welcome-heading');
                            if (welcomeHeading) {
                                welcomeHeading.textContent = `Hey ${fallbackName}, Let's begin.`;
                            }
                        }
                    }
                } catch (e) {
                    console.error('❌ Error fetching user name:', e);
                }
                
                hideLoginModal();
                await loadFamilyCase();
                
                // Show success message
                console.log('✅ You can now complete the obituary form');
                
            } catch (error) {
                console.error('Login error:', error);
                errorMessage.textContent = error.message || 'Failed to sign in. Please check your credentials.';
                errorMessage.style.display = 'block';
                
                // Re-enable button
                loginBtn.disabled = false;
                loginBtn.textContent = 'Sign In';
            }
        }
        
        // Form content is hidden by CSS initially

        // Initialize obituary data
        const obituaryData = { name: "", content: "" };
        let originalObituaryData = {};
        let originalFormPayload = {};
        // 🔑 holds the Wait node's per-execution resume URL (from n8n)
        let MEMORIO_RESUME_URL = "";
        
        // ============================================================================
        // AUTHENTICATION & CASE LOADING
        // ============================================================================
        
        /**
         * Check if family user is authenticated
         * If not, redirect to family login page
         * If yes, load their assigned case
         */
        async function checkAuthentication() {
            try {
                // Get current session
                const { data: { session }, error: sessionError } = await supabaseClient.auth.getSession();
                
                if (sessionError || !session) {
                    console.log('No active session, showing login modal...');
                    showLoginModal();
                    return false;
                }
                
                // Fetch user data from database (EXACT same as Director Portal)
                const { data: userData, error: userError } = await supabaseClient
                    .from('users')
                    .select('role, metadata')
                    .eq('id', session.user.id)
                    .single();
                
                console.log('✅ User authenticated:', session.user.email);
                console.log('🔐 Database user data:', userData);
                
                if (userError || !userData || userData.role !== 'family') {
                    console.error('❌ Not a family member or user not found:', userError);
                    showLoginModal();
                    return false;
                }
                
                // Check if user needs to change password (EXACT same check as Director Portal)
                if (userData.metadata?.requires_password_change === true) {
                    console.log('⚠️ First login detected - forcing password change');
                    showPasswordChangeModal();
                    return false; // Block form access until password is changed
                }
                
                // Set currentUser with full data
                currentUser = {
                    id: session.user.id,
                    email: session.user.email,
                    ...userData
                };
                
                // Fetch user's name for personalized greeting
                try {
                    console.log('📡 Attempting to fetch user data from database...');
                    const { data: userData, error: userError } = await supabaseClient
                        .from('users')
                        .select('metadata')
                        .eq('id', currentUser.id)
                        .single();
                    
                    if (userError) {
                        console.error('❌ Database query failed:', userError);
                        console.error('❌ Error code:', userError.code);
                        console.error('❌ Error message:', userError.message);
                        console.error('❌ Error details:', userError.details);
                        console.error('❌ Error hint:', userError.hint);
                    }
                    
                    if (!userError && userData?.metadata?.name) {
                        const userName = userData.metadata.name;
                        console.log('✅ User name loaded:', userName);
                        
                        // Update the welcome heading with personalized greeting
                        const welcomeHeading = document.getElementById('welcome-heading');
                        if (welcomeHeading) {
                            welcomeHeading.textContent = `Hey ${userName}, Let's begin.`;
                        }
                    } else {
                        console.warn('⚠️ Could not load user name from database:', userError);
                        // Fallback: try to get name from user_metadata (JWT)
                        const fallbackName = currentUser.user_metadata?.name;
                        if (fallbackName) {
                            console.log('✅ User name loaded from JWT:', fallbackName);
                            const welcomeHeading = document.getElementById('welcome-heading');
                            if (welcomeHeading) {
                                welcomeHeading.textContent = `Hey ${fallbackName}, Let's begin.`;
                            }
                        }
                    }
                } catch (e) {
                    console.error('❌ Error fetching user name:', e);
                    // Continue without personalization - will show default "Lets begin!"
                }
                
                // Check if form is already completed BEFORE loading the page
                const { data: cases, error: caseError } = await supabaseClient
                    .from('cases')
                    .select('id')
                    .eq('assigned_family_user_id', currentUser.id)
                    .single();
                
                if (!caseError && cases) {
                    // Check if form has already been submitted
                    const { data: forms, error: formError } = await supabaseClient
                        .from('forms')
                        .select('submitted_at')
                        .eq('case_id', cases.id)
                        .single();
                    
                    // Check if user is in edit mode
                    const urlParams = new URLSearchParams(window.location.search);
                    const isEditMode = urlParams.get('mode') === 'edit';
                    
                    if (!formError && forms && forms.submitted_at && !isEditMode) {
                        console.log('✅ Form already submitted, redirecting to dashboard immediately...');
                        // Form is already completed and not in edit mode, redirect immediately without showing form
                        if (canRedirect()) {
                            setRedirectLock();
                            window.location.href = '/m-family-7x2p/dashboard.html';
                        } else {
                            console.error('🛑 Redirect loop detected! Stopping to prevent infinite loop.');
                            alert('There seems to be an issue with your account setup. Please contact support or clear your browser cache and try again.');
                        }
                        return false; // Stop execution
                    } else {
                        // Clear redirect lock when staying on form page
                        sessionStorage.removeItem(REDIRECT_LOCK_KEY);
                    }
                    
                    if (isEditMode && forms && forms.submitted_at) {
                        console.log('✅ Edit mode enabled - family can update their submission');
                        // In edit mode, allow editing and pre-fill form with existing data
                        // TODO: Pre-fill form fields with existing form data
                    }
                }
                
                // Form not completed yet, continue with normal flow
                console.log('✅ Form not completed yet, loading case...');
                await loadFamilyCase();
                
                return true;
            } catch (error) {
                console.error('Authentication error:', error);
                console.log('Error occurred, showing login modal...');
                showLoginModal();
                return false;
            }
        }
        
        /**
         * Load the case assigned to the current family user
         * (Form completion check is now handled in checkAuthentication)
         */
        async function loadFamilyCase() {
            try {
                const { data: cases, error } = await supabaseClient
                    .from('cases')
                    .select('*')
                    .eq('assigned_family_user_id', currentUser.id)
                    .single();
                
                if (error) {
                    console.error('Error loading case:', error);
                    alert('Error: No case found assigned to your account. Please contact your funeral director.');
                    return;
                }
                
                currentCase = cases;
                console.log('✅ Case loaded:', currentCase.deceased_name, '| Case ID:', currentCase.id);
                
                // Show the form content now that we know user hasn't completed it
                const formContent = document.querySelector('.form-container, .form-wrapper, .w-form');
                if (formContent) {
                    formContent.classList.add('show');
                }
                
                // Optionally pre-fill deceased name in form if needed
                // const deceasedNameField = document.querySelector('[name="loved_ones_name"]');
                // if (deceasedNameField && !deceasedNameField.value) {
                //     deceasedNameField.value = currentCase.deceased_name;
                // }
                
            } catch (error) {
                console.error('Error loading case:', error);
                alert('Error: Failed to load case information. Please try again.');
            }
        }
        
        /**
         * Save form data to Supabase database
         * This runs AFTER N8N webhook succeeds
         */
        async function saveFormToDatabase(formPayload) {
            if (!currentCase) {
                console.warn('⚠️ No case loaded, skipping database save');
                return;
            }
            
            try {
                console.log('💾 Saving form data to database...');
                
                // Check if a form record already exists for this case
                const { data: existingForms, error: checkError } = await supabaseClient
                    .from('forms')
                    .select('id')
                    .eq('case_id', currentCase.id)
                    .single();
                
                let formResult;
                
                if (existingForms) {
                    // Update existing form
                    formResult = await supabaseClient
                        .from('forms')
                        .update({
                            submitted_json: formPayload,
                            submitted_at: new Date().toISOString(),
                            updated_at: new Date().toISOString()
                        })
                        .eq('id', existingForms.id)
                        .select();
                } else {
                    // Create new form record
                    formResult = await supabaseClient
                        .from('forms')
                        .insert({
                            case_id: currentCase.id,
                            json_schema_version: 'v1',
                            submitted_json: formPayload,
                            submitted_at: new Date().toISOString()
                        })
                        .select();
                }
                
                if (formResult.error) {
                    console.error('❌ Error saving form to database:', formResult.error);
                    // Don't block the user experience, just log the error
                    return;
                }
                
                console.log('✅ Form data saved to database successfully');
                
                // Save uploaded photos to Supabase Storage and assets table
                await saveUploadedPhotos();
                
                // Update case status to 'submitted'
                await updateCaseStatus('submitted');
                
            } catch (error) {
                console.error('❌ Error in saveFormToDatabase:', error);
                // Don't block the user experience
            }
        }
        
        /**
         * Handle photo selection and preview
         */
        function handlePhotoSelection() {
            const input = document.getElementById('photo_upload');
            const preview = document.getElementById('photo-preview');
            
            input.addEventListener('change', (e) => {
                const files = Array.from(e.target.files);
                selectedPhotos = files;
                
                console.log(`📷 ${files.length} photo(s) selected`);
                
                // Clear preview
                preview.innerHTML = '';
                
                // Generate previews
                files.forEach((file, index) => {
                    const reader = new FileReader();
                    
                    reader.onload = (event) => {
                        const wrapper = document.createElement('div');
                        wrapper.style.cssText = 'position: relative; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1);';
                        
                        const img = document.createElement('img');
                        img.src = event.target.result;
                        img.style.cssText = 'width: 100%; height: 120px; object-fit: cover; display: block;';
                        
                        const removeBtn = document.createElement('button');
                        removeBtn.textContent = '×';
                        removeBtn.type = 'button';
                        removeBtn.style.cssText = 'position: absolute; top: 5px; right: 5px; background: rgba(0,0,0,0.7); color: white; border: none; border-radius: 50%; width: 24px; height: 24px; cursor: pointer; font-size: 18px; line-height: 20px;';
                        removeBtn.onclick = () => {
                            selectedPhotos.splice(index, 1);
                            wrapper.remove();
                        };
                        
                        wrapper.appendChild(img);
                        wrapper.appendChild(removeBtn);
                        preview.appendChild(wrapper);
                    };
                    
                    reader.readAsDataURL(file);
                });
            });
        }
        
        /**
         * Save uploaded photos to Supabase Storage and assets table
         */
        async function saveUploadedPhotos() {
            if (!currentCase || !currentUser) {
                console.warn('⚠️ No case or user loaded, skipping photo save');
                return;
            }
            
            if (!selectedPhotos || selectedPhotos.length === 0) {
                console.log('📷 No photos selected');
                return;
            }
            
            try {
                console.log(`📷 Uploading ${selectedPhotos.length} photo(s) to Supabase Storage...`);
                
                for (let i = 0; i < selectedPhotos.length; i++) {
                    const file = selectedPhotos[i];
                    
                    try {
                        // Generate unique file path
                        const fileExt = file.name.split('.').pop();
                        const fileName = `${currentCase.id}/${Date.now()}_${i}.${fileExt}`;
                        
                        console.log(`📷 Uploading: ${file.name} → ${fileName}`);
                        
                        // Upload to Supabase Storage
                        const { data: uploadData, error: uploadError } = await supabaseClient.storage
                            .from('case-assets')
                            .upload(fileName, file, {
                                cacheControl: '3600',
                                upsert: false
                            });
                        
                        if (uploadError) {
                            console.error('❌ Error uploading photo:', uploadError);
                            continue;
                        }
                        
                        // Get public URL
                        const { data: { publicUrl } } = supabaseClient.storage
                            .from('case-assets')
                            .getPublicUrl(fileName);
                        
                        console.log(`✅ Photo uploaded: ${publicUrl}`);
                        
                        // Save to assets table
                        const { error: assetError } = await supabaseClient
                            .from('assets')
                            .insert({
                                case_id: currentCase.id,
                                uploader_user_id: currentUser.id,
                                file_key: publicUrl,
                                mime_type: file.type,
                                size_bytes: file.size,
                                metadata: {
                                    source: 'supabase_storage',
                                    original_filename: file.name,
                                    uploaded_via: 'form_submission'
                                }
                            });
                        
                        if (assetError) {
                            console.error('❌ Error saving photo to assets table:', assetError);
                        } else {
                            console.log('✅ Photo saved to assets table');
                        }
                    } catch (photoError) {
                        console.error('❌ Error processing individual photo:', photoError);
                    }
                }
                
                console.log('✅ All photos processed');
            } catch (error) {
                console.error('❌ Error saving uploaded photos:', error);
                // Don't block the user experience
            }
        }
        
        /**
         * Update case status in database
         */
        async function updateCaseStatus(newStatus) {
            if (!currentCase) return;
            
            try {
                const { error } = await supabaseClient
                    .from('cases')
                    .update({
                        status: newStatus,
                        updated_at: new Date().toISOString()
                    })
                    .eq('id', currentCase.id);
                
                if (error) {
                    console.error('❌ Error updating case status:', error);
                    return;
                }
                
                console.log(`✅ Case status updated to: ${newStatus}`);
                currentCase.status = newStatus;
                
            } catch (error) {
                console.error('❌ Error in updateCaseStatus:', error);
            }
        }
        
        // ---------- helpers ----------
        function extractContent(raw) {
            let text =
                raw?.content ||
                raw?.choices?.[0]?.message?.content ||
                raw?.data?.[0]?.message?.content ||
                raw?.message?.content ||
                raw?.contentText || "";
            return String(text)
                .replace(/\r\n/g, "\n")
                .replace(/\n{1}(?=\S)/g, "\n\n")
                .trim();
        }
        function injectStyles() {
            const styleId = 'memorio-injected-styles';
            if (document.getElementById(styleId)) return;
            const style = document.createElement('style');
            style.id = styleId;
            style.textContent = `
                .writing-status{background:#fff3e9;border-radius:20px;padding:25px;margin-bottom:30px;text-align:center;box-shadow:0 2px 8px -2px rgba(0,0,0,.2);font-family:'Dosis',sans-serif;opacity:1;transition:opacity 0.5s ease-out}
                .writing-status.fade-out{opacity:0}
                .status-text{font-size:18px;margin-bottom:15px;color:#436481;font-family:'Dosis',sans-serif}
                .loading-dots{display:inline-flex;gap:5px}
                .dot{width:8px;height:8px;background:#436481;border-radius:50%;animation:pulse 1.5s infinite}
                .dot:nth-child(2){animation-delay:.3s}
                .dot:nth-child(3){animation-delay:.6s}
                @keyframes pulse{0%,100%{opacity:.3}50%{opacity:1}}
                .obituary-card{background:#fff3e9;border-radius:20px;padding:25px;margin-bottom:30px;box-shadow:0 2px 8px -2px rgba(0,0,0,.2);font-family:'Dosis',sans-serif}
                .obituary-title{font-size:18px;color:#436481;margin-bottom:20px;font-weight:500;border:none;font-family:'Dosis',sans-serif}
                .edit-hint{font-size:13px;color:#7a8592;text-align:center;margin-top:15px;margin-bottom:15px;font-style:italic;opacity:0.7;transition:opacity 0.3s ease;font-family:'Dosis',sans-serif;cursor:default}
                .edit-hint:hover{opacity:0.9}
                .obituary-content{font-size:18px;line-height:1.8;color:#32343a;min-height:200px;cursor:text;background:#fff3e9;border-radius:20px;padding:25px;box-shadow:0 2px 8px -2px rgba(0,0,0,.2);border:none;outline:none;font-family:'Dosis',sans-serif;margin-top:15px;font-weight:400;word-wrap:break-word;white-space:pre-wrap}
                .obituary-content:focus{outline:none;border:none;box-shadow:0 2px 8px -2px rgba(0,0,0,.2)}
                .obituary-content::selection{background-color:rgba(67,100,129,.2)}
                .obituary-content p{margin-bottom:20px;font-size:18px;line-height:1.8;color:#32343a;font-family:'Dosis',sans-serif;font-weight:400}
                .obituary-content p:last-child{margin-bottom:0}
                .obituary-content[contenteditable="true"]{box-shadow:0 2px 8px -2px rgba(67,100,129,.3)}
                .typewriter-cursor{display:inline-block;width:2px;height:22px;background:#32343a;animation:blink 1s infinite;vertical-align:text-top;margin-left:2px}
                @keyframes blink{0%,50%{opacity:1}51%,100%{opacity:0}}
                .action-buttons{display:flex;justify-content:center;margin-top:30px}
                .btn{background:#32343a;color:#fff;border:none;padding:15px 30px;font-size:16px;font-family:'Dosis',sans-serif;border-radius:60px;cursor:pointer;transition:all .3s ease;font-weight:500}
                .btn:hover{background:#436481;transform:translateY(-2px)}
                .btn:disabled{background:#9ca3af;cursor:not-allowed;transform:none}
                .hidden{display:none}
                .fade-in{animation:fadeIn .5s ease-in}
                @keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
                .memorial-info{background:#fff3e9;border-radius:20px;padding:25px;margin-bottom:20px;font-size:16px;color:#32343a;text-align:center;font-family:'Dosis',sans-serif;box-shadow:0 2px 8px -2px rgba(0,0,0,.2)}
                .memorio-container{max-width:800px;margin:0 auto;font-family:'Dosis',sans-serif}
                
                /* Date input group styling */
                .date-input-group{display:flex;gap:10px;margin-bottom:15px}
                .date-input-group .select-field{flex:1;min-width:0}
                .date-input-group .select-field:first-child{flex:1.5}
                .date-input-group .select-field:last-child{flex:1.2}
            `;
            document.head.appendChild(style);
        }
        // ---------- UI mounting (instant loader on submit) ----------
        function mountUIIntoSuccess() {
            const container = document.getElementById('memorio-success-container');
            if (!container) return;
            if (!container.querySelector('#obituaryCard')) {
                container.innerHTML = `
                    <div class="memorio-container">
                        <div id="writingStatus" class="writing-status">
                            <div class="status-text">Crafting your loved one's story...</div>
                            <div class="loading-dots"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>
                        </div>
                        <div id="memorialInfo" class="memorial-info hidden">
                            Thank you for sharing about your loved one. Here's the tribute we've crafted based on the memories you provided.
                        </div>
                        <div id="obituaryCard" class="obituary-card hidden">
                            <div id="obituaryTitle" class="obituary-title">Here's your updated obituary</div>
                            <div id="obituaryContent" class="obituary-content"></div>
                            <div class="edit-hint">Click the text above to make edits</div>
                            <div class="action-buttons">
                                <button class="btn" onclick="publishObituary()">Submit</button>
                                <a href="/m-family-7x2p/dashboard.html" class="btn" style="background: #436481; text-decoration: none; margin-left: 15px;">Access Dashboard</a>
                            </div>
                        </div>
                    </div>`;
            }
            injectStyles();
        }
        // ---------- typewriter flow with loading screen ----------
        function startTypewriter() {
            originalObituaryData = JSON.parse(JSON.stringify(obituaryData));
            // Show loading screen for 2 seconds before starting typewriter
            const status = document.getElementById('writingStatus');
            const memorialInfo = document.getElementById('memorialInfo');
            const card = document.getElementById('obituaryCard');
            setTimeout(() => {
                // Fade out loading screen
                status?.classList.add('fade-out');
                setTimeout(() => {
                    // Hide loading and show memorial info
                    status?.classList.add('hidden');
                    memorialInfo?.classList.remove('hidden');
                    memorialInfo?.classList.add('fade-in');
                    setTimeout(() => {
                        // Show obituary card and start typing
                        card?.classList.remove('hidden');
                        card?.classList.add('fade-in');
                        typeTitle();
                    }, 1000);
                }, 500); // Wait for fade-out to complete
            }, 2000); // Show loading for 2 seconds
        }
        function typeTitle() {
            const titleElement = document.getElementById('obituaryTitle');
            titleElement.textContent = `Here's your updated obituary${obituaryData.name ? ` for ${obituaryData.name}` : ''}`;
            setTimeout(() => { typeContent(); }, 200);
        }
        function typeContent() {
            const contentElement = document.getElementById('obituaryContent');
            contentElement.innerHTML = '';
            contentElement.contentEditable = false;
            const content = obituaryData.content || '';
            if (!content) return;
            const paragraphs = content.split('\n\n').filter(p => p.trim());
            let i = 0, j = 0;
            const cursor = document.createElement('span');
            cursor.className = 'typewriter-cursor';
            function typeNextChar() {
                if (i < paragraphs.length) {
                    const txt = paragraphs[i].trim();
                    if (j < txt.length) {
                        const existingCursor = contentElement.querySelector('.typewriter-cursor');
                        if (existingCursor) existingCursor.remove();
                        if (j === 0) { const p = document.createElement('p'); contentElement.appendChild(p); }
                        const pNow = contentElement.lastElementChild; pNow.textContent += txt.charAt(j); pNow.appendChild(cursor.cloneNode());
                        j++;
                        const prev = txt.charAt(j-1);
                        const speed = prev === '.' ? 80 : prev === ',' ? 60 : Math.random()*20 + 15;
                        setTimeout(typeNextChar, speed);
                    } else {
                        i++; j = 0; if (i < paragraphs.length) setTimeout(typeNextChar, 250); else setTimeout(() => { const c = contentElement.querySelector('.typewriter-cursor'); if (c) c.remove(); makeContentEditable(); }, 600);
                    }
                }
            }
            typeNextChar();
        }
        function makeContentEditable() {
            const el = document.getElementById('obituaryContent');
            const paragraphs = Array.from(el.querySelectorAll('p'));
            const plain = paragraphs.map(p => p.textContent).join('\n\n');
            el.innerHTML = '';
            el.textContent = plain;
            el.contentEditable = true;
            el.addEventListener('click', function(){ this.focus(); }, { once: true });
        }
        // 🔧 Modified to include resumeUrl in payload sent to Email Webhook
        async function publishObituary() {
            const el = document.getElementById('obituaryContent');
            const btn = document.querySelector('.btn');
            // Capture final content with proper formatting
            let finalContent = el.textContent || el.innerText || '';
            finalContent = finalContent.replace(/\n\s*\n/g, '\n\n').trim();
            const finalData = { 
                name: obituaryData.name, 
                content: finalContent,
                originalFormData: originalFormPayload,
                timestamp: new Date().toISOString(),
                // ⬇️ Send the Wait node resume URL so the Email Webhook branch can resume the flow
                resumeUrl: MEMORIO_RESUME_URL || ""
            };
            console.log('Submitting final obituary data:', finalData);
            // Disable button and show loading state
            btn.disabled = true;
            btn.textContent = 'Sending...';
            
            try {
                // First, update the database with the final obituary content
                if (currentCase && currentCase.id) {
                    const { data: existingForms, error: formQueryError } = await supabaseClient
                        .from('forms')
                        .select('id')
                        .eq('case_id', currentCase.id)
                        .single();
                    
                    if (!formQueryError && existingForms) {
                        // Update existing form with final obituary content
                        const { error: updateError } = await supabaseClient
                            .from('forms')
                            .update({
                                submitted_json: {
                                    ...originalFormPayload,
                                    obituary_name: obituaryData.name,
                                    obituary_content: finalContent,
                                    generated_at: new Date().toISOString()
                                },
                                updated_at: new Date().toISOString()
                            })
                            .eq('id', existingForms.id);
                        
                        if (updateError) {
                            console.error('❌ Error updating form with obituary:', updateError);
                        } else {
                            console.log('✅ Successfully updated form with final obituary content');
                        }
                    }
                }
                
                // Then send to email webhook
                console.log('Sending to email webhook:', EMAIL_ENDPOINT);
                console.log('Payload:', finalData);
                const response = await fetch(EMAIL_ENDPOINT, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    mode: 'cors',
                    body: JSON.stringify(finalData)
                });
                console.log('Response status:', 'no-cors mode - status not available');
                console.log('Request sent successfully');
                // In no-cors mode, we can't read the response, so assume success
                btn.textContent = 'Sent!';
                btn.style.background = '#22c55e';
                
                // Add "Access Dashboard" button
                const actionButtons = document.querySelector('.action-buttons');
                if (actionButtons && !document.getElementById('dashboardBtn')) {
                    const dashboardBtn = document.createElement('a');
                    dashboardBtn.id = 'dashboardBtn';
                    dashboardBtn.href = '/m-family-7x2p/dashboard.html';
                    dashboardBtn.className = 'btn';
                    dashboardBtn.textContent = 'Access Dashboard';
                    dashboardBtn.style.marginLeft = '15px';
                    dashboardBtn.style.background = '#436481';
                    dashboardBtn.style.textDecoration = 'none';
                    dashboardBtn.style.display = 'inline-block';
                    actionButtons.appendChild(dashboardBtn);
                }
                
                setTimeout(() => {
                    alert('Obituary submitted successfully! You will receive an email shortly with your final obituary.');
                }, 500);
            } catch (error) {
                console.error('Detailed error submitting obituary:', error);
                console.error('Error name:', error.name);
                console.error('Error message:', error.message);
                btn.disabled = false;
                btn.textContent = 'Submit';
                // More specific error messages
                if (error.name === 'TypeError' && error.message.includes('fetch')) {
                    alert('Network Error: Cannot reach the email webhook. Check N8N webhook status and CORS settings.');
                } else if (error.message.includes('HTTP')) {
                    alert(`Server Error: ${error.message}`);
                } else {
                    alert(`Error: ${error.message}`);
                }
            }
        }
        // ---------- response handling ----------
        async function displayObituary(data, formPayload = {}) {
            // Store original form payload for email submission
            originalFormPayload = JSON.parse(JSON.stringify(formPayload));
            obituaryData.name =
                data?.name ||
                data?.obituary?.name ||
                [formPayload.loved_ones_name, formPayload.loved_ones_last_name].filter(Boolean).join(' ') ||
                [formPayload.customer_name, formPayload.loved_ones_last_name].filter(Boolean).join(' ') ||
                formPayload.loved_ones_name ||
                formPayload.customer_name || '';
            obituaryData.content = extractContent(data);
            // 🔑 Capture resumeUrl from n8n Respond-to-Webhook payload
            MEMORIO_RESUME_URL = data?.resumeUrl || MEMORIO_RESUME_URL || "";
            if (!obituaryData.content) {
                alert('No obituary content was generated. Please check the n8n workflow output.');
                return;
            }
            
            // ✅ AUTO-SAVE: Save obituary to database immediately after N8N generates it
            await saveObituaryToDatabase(obituaryData.name, obituaryData.content);
            
            startTypewriter();
        }
        
        /**
         * Save generated obituary to database
         * This runs automatically after N8N generates the obituary
         */
        async function saveObituaryToDatabase(obituaryName, obituaryContent) {
            if (!currentCase || !currentCase.id) {
                console.warn('⚠️ No case loaded, skipping obituary save');
                return;
            }
            
            try {
                console.log('💾 Auto-saving generated obituary to database...');
                
                // Find the existing form record
                const { data: existingForms, error: formQueryError } = await supabaseClient
                    .from('forms')
                    .select('id, submitted_json')
                    .eq('case_id', currentCase.id)
                    .single();
                
                if (formQueryError || !existingForms) {
                    console.error('❌ Error finding form:', formQueryError);
                    return;
                }
                
                // Update with obituary content
                const updatedJson = {
                    ...existingForms.submitted_json,
                    obituary_name: obituaryName,
                    obituary_content: obituaryContent,
                    generated_at: new Date().toISOString()
                };
                
                const { error: updateError } = await supabaseClient
                    .from('forms')
                    .update({
                        submitted_json: updatedJson,
                        updated_at: new Date().toISOString()
                    })
                    .eq('id', existingForms.id);
                
                if (updateError) {
                    console.error('❌ Error saving obituary:', updateError);
                } else {
                    console.log('✅ Obituary automatically saved to database');
                }
            } catch (error) {
                console.error('❌ Error in saveObituaryToDatabase:', error);
            }
        }
        // Expose functions globally
        window.publishObituary = publishObituary;
        window.displayObituary = displayObituary;
        window.startObituaryTypewriter = function(obituaryContent, userName) { obituaryData.content = obituaryContent; obituaryData.name = userName; startTypewriter(); };
    </script>
  <script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=683b63acf5908465c8825ca8" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <script src="js/webflow.js" type="text/javascript"></script>
  <script>
        // ---------- Date input combination functions ----------
        function combineDateInputs() {
            // Combine passing date
            const monthPassing = document.getElementById('month_of_passing');
            const dayPassing = document.getElementById('day_of_passing');
            const yearPassing = document.getElementById('year_of_passing');
            const datePassingHidden = document.getElementById('date_of_passing');
            
            if (monthPassing && dayPassing && yearPassing && datePassingHidden) {
                const updatePassingDate = () => {
                    if (monthPassing.value && dayPassing.value && yearPassing.value) {
                        datePassingHidden.value = `${yearPassing.value}-${monthPassing.value}-${dayPassing.value}`;
                    }
                };
                monthPassing.addEventListener('change', updatePassingDate);
                dayPassing.addEventListener('change', updatePassingDate);
                yearPassing.addEventListener('change', updatePassingDate);
            }
            
            // Combine birth date
            const monthBirth = document.getElementById('month_of_birth');
            const dayBirth = document.getElementById('day_of_birth');
            const yearBirth = document.getElementById('year_of_birth');
            const dateBirthHidden = document.getElementById('date_of_birth');
            
            if (monthBirth && dayBirth && yearBirth && dateBirthHidden) {
                const updateBirthDate = () => {
                    if (monthBirth.value && dayBirth.value && yearBirth.value) {
                        dateBirthHidden.value = `${yearBirth.value}-${monthBirth.value}-${dayBirth.value}`;
                    }
                };
                monthBirth.addEventListener('change', updateBirthDate);
                dayBirth.addEventListener('change', updateBirthDate);
                yearBirth.addEventListener('change', updateBirthDate);
            }
        }

        // ---------- Force date combination on form submit ----------
        function combineDateInputsOnSubmit() {
            console.log('=== COMBINING DATES ON SUBMIT ===');
            
            // Force combine passing date
            const monthPassing = document.getElementById('month_of_passing');
            const dayPassing = document.getElementById('day_of_passing');
            const yearPassing = document.getElementById('year_of_passing');
            const datePassingHidden = document.getElementById('date_of_passing');
            
            console.log('Passing date elements found:', {
                month: !!monthPassing,
                day: !!dayPassing,
                year: !!yearPassing,
                hidden: !!datePassingHidden
            });
            
            if (monthPassing && dayPassing && yearPassing && datePassingHidden) {
                console.log('Passing date values:', {
                    month: monthPassing.value,
                    day: dayPassing.value,
                    year: yearPassing.value
                });
                
                if (monthPassing.value && dayPassing.value && yearPassing.value) {
                    datePassingHidden.value = `${yearPassing.value}-${monthPassing.value}-${dayPassing.value}`;
                    console.log('✅ Combined passing date:', datePassingHidden.value);
                } else {
                    console.log('❌ Missing passing date values');
                }
            } else {
                console.log('❌ Missing passing date elements');
            }
            
            // Force combine birth date
            const monthBirth = document.getElementById('month_of_birth');
            const dayBirth = document.getElementById('day_of_birth');
            const yearBirth = document.getElementById('year_of_birth');
            const dateBirthHidden = document.getElementById('date_of_birth');
            
            console.log('Birth date elements found:', {
                month: !!monthBirth,
                day: !!dayBirth,
                year: !!yearBirth,
                hidden: !!dateBirthHidden
            });
            
            if (monthBirth && dayBirth && yearBirth && dateBirthHidden) {
                console.log('Birth date values:', {
                    month: monthBirth.value,
                    day: dayBirth.value,
                    year: yearBirth.value
                });
                
                if (monthBirth.value && dayBirth.value && yearBirth.value) {
                    dateBirthHidden.value = `${yearBirth.value}-${monthBirth.value}-${dayBirth.value}`;
                    console.log('✅ Combined birth date:', dateBirthHidden.value);
                } else {
                    console.log('❌ Missing birth date values');
                }
            } else {
                console.log('❌ Missing birth date elements');
            }
            
            console.log('=== DATE COMBINATION COMPLETE ===');
        }

        // ---------- Hook into the Webflow form AFTER Webflow loads ----------
        (function() {
            injectStyles();
            combineDateInputs();
            const wrapper = document.querySelector('.w-form');
            const form = wrapper?.querySelector('form');
            const success = wrapper?.querySelector('.w-form-done');
            const fail = wrapper?.querySelector('.w-form-fail');
            
            if (!form || !success) {
                console.error('Form or success element not found');
                return;
            }
            
            // Remove Webflow's default form handler
            form.removeAttribute('data-wf-element-id');
            form.removeAttribute('data-wf-page-id');
            
            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                e.stopPropagation();
                console.log('Form submitted - our handler');
                
                // Ensure date fields are combined before submission
                combineDateInputsOnSubmit();
                
                // Swap to success area immediately, then mount loader UI so it shows right away
                form.style.display = 'none';
                success.style.display = 'block';
                fail.style.display = 'none';
                mountUIIntoSuccess();
                
                const payload = Object.fromEntries(new FormData(form).entries());
                console.log('Form payload:', payload);
                console.log('Date fields check:');
                console.log('- date_of_birth:', payload.date_of_birth);
                console.log('- date_of_passing:', payload.date_of_passing);
                console.log('- month_of_birth:', payload.month_of_birth);
                console.log('- day_of_birth:', payload.day_of_birth);
                console.log('- year_of_birth:', payload.year_of_birth);
                console.log('- month_of_passing:', payload.month_of_passing);
                console.log('- day_of_passing:', payload.day_of_passing);
                console.log('- year_of_passing:', payload.year_of_passing);
                
                try {
                    console.log('Fetching from:', ENDPOINT);
                    const res = await fetch(ENDPOINT, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
                        mode: 'cors',
                        body: JSON.stringify(payload)
                    });
                    
                    if (!res.ok) throw new Error(`HTTP ${res.status}: ${res.statusText}`);
                    const raw = await res.json();
                    console.log('N8N Response:', raw);
                    
                    // ✅ DUAL SUBMISSION: After N8N succeeds, save to database
                    await saveFormToDatabase(payload);
                    
                    displayObituary(raw, payload);
                } catch (err) {
                    console.error('Submit error:', err);
                    if (err.name === 'TypeError' && err.message.includes('fetch')) {
                        alert(`Network Error: Cannot reach the webhook. This could be due to:\n1. CORS policy blocking the request\n2. Webhook endpoint is down\n3. Network connectivity issues`);
                    }
                    if (confirm('Webhook failed. Would you like to test with sample data instead?')) {
                        const sampleResponse = {
                            content: `${payload.loved_ones_name || 'Your loved one'} was a remarkable person who touched the lives of everyone they met. Born with a generous spirit and kind heart, they dedicated their life to family, friends, and community.\n\nThroughout their years, they showed unwavering love and support to those around them. Their wisdom, humor, and compassion will be deeply missed by all who had the privilege of knowing them.\n\nThey leave behind a legacy of love, kindness, and cherished memories that will live on in the hearts of family and friends forever.\n\nA celebration of their life will be held to honor their memory and the profound impact they had on all our lives.`,
                            resumeUrl: ""
                        };
                        displayObituary(sampleResponse, payload);
                    } else {
                        success.style.display = 'none';
                        if (fail) fail.style.display = 'block';
                    }
                }
            });
            
        // Listen for iframe postMessage if needed
            window.addEventListener('message', (e) => { 
                if (e.data?.type === 'obituary-data') displayObituary(e.data.obituary || {}); 
            });
            
            // ============================================================================
            // INITIALIZE PHOTO UPLOAD HANDLER
            // ============================================================================
            handlePhotoSelection();
            
            // ============================================================================
            // CHECK AUTHENTICATION ON PAGE LOAD
            // ============================================================================
            // Check if family user is authenticated and load their case
            checkAuthentication().then(isAuthenticated => {
                if (isAuthenticated) {
                    console.log('✅ Page ready - User authenticated and case loaded');
                    // Initialize family portal enhancements after authentication
                    initFamilyPortalEnhancements();
                } else {
                    console.log('⚠️ Page ready - Operating without authentication (testing mode)');
                }
            });
        })();
        
        // ============================================================================
        // FAMILY PORTAL ENHANCEMENTS
        // ============================================================================
        function initFamilyPortalEnhancements() {
            // Hide funeral home step
            hideFuneralHomeStep();
            
            // Populate deceased name throughout form
            populateDeceasedName();
            
            // Add persistent dashboard icon
            addPersistentDashboardIcon();
            
            // Initialize autosave
            initializeAutosave();
            
            // Update review screen
            updateReviewScreen();
            
            console.log('✅ Family portal enhancements initialized');
        }
        
        /**
         * Hide the funeral home question step (collected by director)
         */
        function hideFuneralHomeStep() {
            // Find the funeral home step by looking for the input field
            const funeralHomeInput = document.getElementById('funeral_home');
            if (funeralHomeInput) {
                // Find the parent step container
                const stepContainer = funeralHomeInput.closest('.form-slider-step-1');
                if (stepContainer) {
                    stepContainer.style.display = 'none';
                    console.log('✅ Funeral home step hidden');
                }
            }
        }
        
        /**
         * Populate deceased name dynamically throughout the form
         */
        function populateDeceasedName() {
            if (!currentCase || !currentCase.deceased_name) {
                console.warn('⚠️ No case loaded or deceased name not available');
                return;
            }
            
            const deceasedName = currentCase.deceased_name.split(' ')[0]; // Use first name
            
            // Update the "Any other names" label
            const deceasedNameDisplay = document.getElementById('deceased-name-display');
            if (deceasedNameDisplay) {
                deceasedNameDisplay.textContent = deceasedName;
            }
            
            // Auto-populate hidden fields with data from case metadata (collected by director)
            if (currentCase.metadata) {
                const metadata = currentCase.metadata;
                
                // Populate name fields if they exist
                if (metadata.full_name) {
                    const nameParts = metadata.full_name.split(' ');
                    const firstNameField = document.getElementById('loved_ones_name');
                    const lastNameField = document.getElementById('loved_ones_last_name');
                    if (firstNameField) firstNameField.value = nameParts[0] || '';
                    if (lastNameField) lastNameField.value = nameParts.slice(1).join(' ') || '';
                }
                
                // Populate gender
                if (metadata.gender) {
                    const genderField = document.getElementById('loved_ones_gender');
                    if (genderField) genderField.value = metadata.gender;
                }
                
                // Store DOB/DOD for auto-population if needed
                if (metadata.date_of_birth || metadata.date_of_death) {
                    // These can be used to pre-fill date fields if needed
                    console.log('📅 DOB/DOD available from director:', {
                        dob: metadata.date_of_birth,
                        dod: metadata.date_of_death
                    });
                }
            }
            
            console.log('✅ Deceased name populated:', deceasedName);
        }
        
        /**
         * Add persistent dashboard icon (always visible, non-intrusive)
         */
        function addPersistentDashboardIcon() {
            // Check if icon already exists
            if (document.getElementById('persistent-dashboard-icon')) {
                return;
            }
            
            const dashboardIcon = document.createElement('a');
            dashboardIcon.id = 'persistent-dashboard-icon';
            dashboardIcon.href = '/m-family-7x2p/dashboard.html';
            dashboardIcon.innerHTML = `
                <div style="position: fixed; bottom: 20px; right: 20px; z-index: 9998; background-color: #436481; color: white; width: 56px; height: 56px; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(0,0,0,0.2); cursor: pointer; transition: all 0.3s ease; text-decoration: none;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="3" y="3" width="7" height="7"></rect>
                        <rect x="14" y="3" width="7" height="7"></rect>
                        <rect x="14" y="14" width="7" height="7"></rect>
                        <rect x="3" y="14" width="7" height="7"></rect>
                    </svg>
                </div>
            `;
            dashboardIcon.title = 'Go to Dashboard';
            document.body.appendChild(dashboardIcon);
            console.log('✅ Persistent dashboard icon added');
        }
        
        /**
         * Initialize autosave functionality
         */
        function initializeAutosave() {
            let autosaveTimeout;
            const AUTOSAVE_DELAY = 2000; // 2 seconds after last change
            
            // Get all form inputs
            const formInputs = document.querySelectorAll('#wf-form-memorio_obituary_form input, #wf-form-memorio_obituary_form textarea, #wf-form-memorio_obituary_form select');
            
            formInputs.forEach(input => {
                input.addEventListener('change', () => {
                    clearTimeout(autosaveTimeout);
                    autosaveTimeout = setTimeout(() => {
                        saveFormDraft();
                    }, AUTOSAVE_DELAY);
                });
                
                // Also autosave on input for text fields
                if (input.type === 'text' || input.type === 'textarea') {
                    input.addEventListener('input', () => {
                        clearTimeout(autosaveTimeout);
                        autosaveTimeout = setTimeout(() => {
                            saveFormDraft();
                        }, AUTOSAVE_DELAY);
                    });
                }
            });
            
            // Load existing draft on page load
            loadFormDraft();
            
            console.log('✅ Autosave initialized');
        }
        
        /**
         * Save form draft to database
         */
        async function saveFormDraft() {
            if (!currentCase) {
                console.warn('⚠️ No case loaded, skipping autosave');
                return;
            }
            
            try {
                // Collect all form data
                const formData = {};
                const formInputs = document.querySelectorAll('#wf-form-memorio_obituary_form input, #wf-form-memorio_obituary_form textarea, #wf-form-memorio_obituary_form select');
                
                formInputs.forEach(input => {
                    if (input.name && input.value) {
                        formData[input.name] = input.value;
                    }
                });
                
                // Also save photo selection state
                if (selectedPhotos && selectedPhotos.length > 0) {
                    formData._photo_count = selectedPhotos.length;
                }
                
                // Save to forms table as draft
                const { error } = await supabaseClient
                    .from('forms')
                    .upsert({
                        case_id: currentCase.id,
                        draft_json: formData,
                        json_schema_version: 'v1',
                        updated_at: new Date().toISOString()
                    }, {
                        onConflict: 'case_id'
                    });
                
                if (error) {
                    console.error('❌ Autosave failed:', error);
                } else {
                    console.log('💾 Form draft autosaved');
                    // Show subtle success indicator
                    showAutosaveIndicator();
                }
            } catch (error) {
                console.error('❌ Autosave error:', error);
            }
        }
        
        /**
         * Load existing form draft
         */
        async function loadFormDraft() {
            if (!currentCase) {
                return;
            }
            
            try {
                const { data, error } = await supabaseClient
                    .from('forms')
                    .select('draft_json, submitted_at')
                    .eq('case_id', currentCase.id)
                    .single();
                
                if (error || !data || !data.draft_json || data.submitted_at) {
                    // No draft or already submitted
                    return;
                }
                
                // Restore form values
                const draftData = data.draft_json;
                Object.keys(draftData).forEach(key => {
                    if (key.startsWith('_')) return; // Skip meta fields
                    
                    const input = document.querySelector(`[name="${key}"]`);
                    if (input && !input.value) { // Only restore if field is empty
                        input.value = draftData[key];
                    }
                });
                
                console.log('✅ Form draft loaded');
            } catch (error) {
                console.error('❌ Failed to load draft:', error);
            }
        }
        
        /**
         * Show autosave indicator
         */
        function showAutosaveIndicator() {
            // Check if indicator already exists
            let indicator = document.getElementById('autosave-indicator');
            if (!indicator) {
                indicator = document.createElement('div');
                indicator.id = 'autosave-indicator';
                indicator.style.cssText = 'position: fixed; top: 20px; right: 20px; background-color: #4caf50; color: white; padding: 8px 16px; border-radius: 8px; font-size: 14px; font-family: "Dosis Variablefont Wght", Arial, sans-serif; z-index: 9999; opacity: 0; transition: opacity 0.3s ease;';
                indicator.textContent = '✓ Saved';
                document.body.appendChild(indicator);
            }
            
            // Show briefly
            indicator.style.opacity = '1';
            setTimeout(() => {
                indicator.style.opacity = '0';
            }, 2000);
        }
        
        /**
         * Update review screen - remove "Access Dashboard" button
         */
        function updateReviewScreen() {
            // The review/final screen typically has the obituary preview
            // We need to remove any "Access Dashboard" button if it exists
            // The persistent icon will be the only dashboard access point
            
            // This will be executed when the user reaches the final step
            // For now, just log that this is initialized
            console.log('✅ Review screen updated (dashboard button removed, persistent icon active)');
        }
    </script>
  <script src="https://cdn.prod.website-files.com/683b63acf5908465c8825ca8%2F685146e1d8a68f749232b664%2F68ae0b3e267aed7d50d43ce0%2Femptyfieldsremoval-1.0.0.js" type="text/javascript"></script>
  <script src="https://cdn.prod.website-files.com/683b63acf5908465c8825ca8%2F685146e1d8a68f749232b664%2F68ae0b3e451db983d19c0c84%2Fmetadatahandler-0.0.5.js" type="text/javascript"></script>
  <script src="https://cdn.prod.website-files.com/683b63acf5908465c8825ca8%2F685146e1d8a68f749232b664%2F68ae0b3eebf6ed82e6d479bc%2Fenablevisiblebuttons-0.0.7.js" type="text/javascript"></script>
  <script src="https://cdn.prod.website-files.com/683b63acf5908465c8825ca8%2F685146e1d8a68f749232b664%2F68ae0b3e5d17346e14370d63%2Fenableuploadstateview-0.0.3.js" type="text/javascript"></script>
</body>
</html>